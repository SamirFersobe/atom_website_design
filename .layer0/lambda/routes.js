var rc=Object.create;var rr=Object.defineProperty;var sc=Object.getOwnPropertyDescriptor;var nc=Object.getOwnPropertyNames;var ic=Object.getPrototypeOf,oc=Object.prototype.hasOwnProperty;var f=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),ac=(e,t)=>{for(var r in t)rr(e,r,{get:t[r],enumerable:!0})},ei=(e,t,r,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of nc(t))!oc.call(e,i)&&i!==r&&rr(e,i,{get:()=>t[i],enumerable:!(s=sc(t,i))||s.enumerable});return e};var ti=(e,t,r)=>(r=e!=null?rc(ic(e)):{},ei(t||!e||!e.__esModule?rr(r,"default",{value:e,enumerable:!0}):r,e)),uc=e=>ei(rr({},"__esModule",{value:!0}),e);var T=f(E=>{"use strict";Object.defineProperty(E,"__esModule",{value:!0});E.LAYER0_CONFIG_FILE="layer0.config.js";E.LAYER0_ASSET_ALIASES_FILE="asset-aliases.json";E.LAYER0_ENV_VARIABLES={config:"LAYER0_CONFIG",deploymentType:"LAYER0_DEPLOYMENT_TYPE",versionOverride:"LAYER0_VERSION_OVERRIDE"};E.LAYER0_DEPLOYMENT_TYPE_AWS="AWS";E.LAYER0_HEADERS_PREFIX="x-0-";E.LAYER0_MAX_USER_HEADERS_ALLOWED=70;E.LAYER0_TOO_MANY_HEADERS_STATUS_CODE=542;E.LAYER0_UNCACHED_PREFETCH_STATUS=412;E.ACTIONS={setHeader:"set-header",updateHeader:"update-header",removeHeader:"remove-header",syntheticRes:"synthetic-response",updatePath:"update-path",proxy:"proxy",addCookie:"add-cookie",updateCookie:"update-cookie",removeCookie:"remove-cookie"};E.BACKENDS={js:"__js__",static:"__static__",permanentStatic:"__permanent_static__",imageOptimizer:"__image_optimizer__"};E.JS_BACKEND_HOSTNAME="127.0.0.1";E.HTTP_METHODS={head:"head",get:"get",post:"post",delete:"delete",put:"put",patch:"patch",options:"options"};E.HTTP_HEADERS={authorization:"authorization",acceptEncoding:"accept-encoding",cacheControl:"cache-control",contentEncoding:"content-encoding",contentLength:"content-length",contentType:"content-type",cookie:"cookie",host:"host",location:"location",serverTiming:"server-timing",setCookie:"set-cookie",userAgent:"user-agent",vary:"vary",via:"via",xForwardedFor:"x-forwarded-for",xRequestId:"x-request-id",xSwCacheControl:"x-sw-cache-control",x0Browser:"x-0-browser",x0CacheControl:"x-0-cache-control",x0CachingStatus:"x-0-caching-status",x0ClientIp:"x-0-client-ip",x0Components:"x-0-components",x0Destination:"x-0-destination",x0Device:"x-0-device",x0DeviceIsBot:"x-0-device-is-bot",x0GeoCity:"x-0-geo-city",x0GeoCountryCode:"x-0-geo-country-code",x0GeoLatitude:"x-0-geo-latitude",x0GeoLongitude:"x-0-geo-longitude",x0GeoPostalCode:"x-0-geo-postal-code",x0MatchedRoutes:"x-0-matched-routes",x0Protocol:"x-0-protocol",x0Route:"x-0-route",x0Status:"x-0-status",x0SurrogateKey:"x-0-surrogate-key",x0T:"x-0-t",x0UserT:"x-0-user-t",x0Vendor:"x-0-vendor",x0Version:"x-0-version"};E.CACHING_STATUS={ok:"ok",private:"private",method:"method",bodyTooBig:"body-too-big",code:"code",setCookie:"set-cookie",noMaxAge:"no-max-age"};E.CACHEABLE_METHODS=new Set(["get","head"]);E.THROTTLED_QUERY_PARAM="layer0_prefetch";E.PREFETCH_QUERY_PARAM=E.THROTTLED_QUERY_PARAM;E.PREFETCH_TTL_PARAM="layer0_prefetch_ttl";E.DEVTOOLS_PREFETCH_QUERY_PARAM="layer0_dt_pf";E.HEAD_QUERY_PARAM="layer0_head";E.POST_BODY_QUERY_PARAM="pref_layer0_body";E.METHOD_QUERY_PARAM="pref_layer0_method";E.ROUTES_FALLBACK="fallback";E.ROUTES_CATCH_GROUP="catch";E.ROUTES_NOINDEX_GROUP="noindex";E.LAYER0_IMAGE_OPTIMIZER_PATH="/__layer0_image_optimizer";E.IS_BROWSER=typeof window<"u";E.BROTLI_ENCODING="br";E.GZIP_ENCODING="gzip"});var $e=f(_e=>{"use strict";Object.defineProperty(_e,"__esModule",{value:!0});var ri=T();function si(){return process.env[ri.LAYER0_ENV_VARIABLES.deploymentType]===ri.LAYER0_DEPLOYMENT_TYPE_AWS}_e.isCloud=si;function cc(){return process.env.LAYER0_LOCAL==="true"}_e.isLocal=cc;function ni(){return process.env.NODE_ENV==="production"}_e.isProductionBuild=ni;function lc(){return!si()&&!ni()}_e.isLayer0RunDev=lc;function hc(){return typeof window<"u"}_e.isBrowser=hc});var it=f((Lg,ii)=>{"use strict";ii.exports=e=>{let t=/^\\\\\?\\/.test(e),r=/[^\u0000-\u0080]+/.test(e);return t||r?e:e.replace(/\\/g,"/")}});var ae=f((exports,module)=>{"use strict";var __importDefault=exports&&exports.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});var slash_1=__importDefault(it());function nonWebpackRequire(modulePath,{ignoreErrors=!1}={}){try{return eval("require")(slash_1.default(modulePath))}catch(e){if(ignoreErrors)return;throw e}}exports.default=nonWebpackRequire});var ci=f(ge=>{"use strict";var dc=ge&&ge.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(ge,"__esModule",{value:!0});var fc=$e(),oi=dc(ae()),ai="layer0",Xr;function pc(e){return fc.isLocal()?_c().runAndReturn(e):(global.__layer0_timings__=new Zr,e())}ge.withContext=pc;function ui(){return global.__layer0_timings__||gc()}function _c(){let e=oi.default("cls-hooked");return Xr||(Xr=e.createNamespace(ai)),Xr}function gc(){return oi.default("cls-hooked").getNamespace(ai)}function mc(e,t){try{let r=ui(),s=r.get(e);return s==null&&(s=t,r.set(e,t)),s}catch{return t}}ge.get=mc;function vc(e,t){try{ui().set(e,t)}catch{throw new Error("set must be called within withContext")}}ge.set=vc;var Zr=class{constructor(){this.values={}}get(t){return this.values[t]}set(t,r){this.values[t]=r}}});var ns=f($=>{"use strict";Object.defineProperty($,"__esModule",{value:!0});var sr=T(),ts=ci();$.NOT_ENDED_VALUE="na";var nr=class{constructor(t,r=!0){this.duration=0,this.ended=!1,this.name=t,(r?rs():ss()).push(this)}start(){return this.startTime=new Date,this.ended=!1,this}set(t){return this.discreteValue=t,this}end(){return this.startTime?(this.ended=!0,this.duration+=new Date().getTime()-this.startTime.getTime(),this):(console.warn(`Timing ${this.name} not started.`),this)}pause(){return this.end()}resume(){return this.start()}get value(){return this.discreteValue!=null?this.discreteValue:this.ended?this.duration:$.NOT_ENDED_VALUE}};$.InternalTiming=nr;function yc(e){return(...t)=>ts.withContext(()=>e(...t))}$.withTimings=yc;function Ec(e){var t;return(t=rs().find(r=>r.name===e))===null||t===void 0?void 0:t.value}$.getInternalTiming=Ec;function rs(){return ts.get("internalTimings",[])}function ss(){return ts.get("userTimings",[])}function Rc(e){let t=ss(),r=rs();t.length&&(e.setHeader(sr.HTTP_HEADERS.x0UserT,li(t)),e.setHeader(sr.HTTP_HEADERS.serverTiming,Cc(e))),r.length&&e.setHeader(sr.HTTP_HEADERS.x0T,li(r))}$.addTimings=Rc;function li(e){return e.map(t=>`${t.name}=${t.value}`).join(",")}function Cc(e){let t=e.getHeader(sr.HTTP_HEADERS.serverTiming),r=ss().map(s=>`${s.name};dur=${s.value}`);return Array.isArray(t)?r.push(...t):t&&r.push(t),r.join(", ")}var es=class extends nr{constructor(t){super(t,!1)}};$.default=es;var bc;(function(e){e.edgeCache="ecc",e.transformRequest="wa",e.transformResponse="wz",e.routeMatching="wr",e.proxying="wp"})(bc=$.InternalNames||($.InternalNames={}));var Ac;(function(e){e.hit="hit",e.pass="pass",e.cached="cached"})(Ac=$.CacheValue||($.CacheValue={}))});var os=f(is=>{"use strict";Object.defineProperty(is,"__esModule",{value:!0});is.default=Sc;var wc=Tc(require("crypto"));function Tc(e){return e&&e.__esModule?e:{default:e}}var or=new Uint8Array(256),ir=or.length;function Sc(){return ir>or.length-16&&(wc.default.randomFillSync(or),ir=0),or.slice(ir,ir+=16)}});var hi=f(ar=>{"use strict";Object.defineProperty(ar,"__esModule",{value:!0});ar.default=void 0;var xc=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;ar.default=xc});var ot=f(ur=>{"use strict";Object.defineProperty(ur,"__esModule",{value:!0});ur.default=void 0;var Hc=Oc(hi());function Oc(e){return e&&e.__esModule?e:{default:e}}function Pc(e){return typeof e=="string"&&Hc.default.test(e)}var Dc=Pc;ur.default=Dc});var at=f(cr=>{"use strict";Object.defineProperty(cr,"__esModule",{value:!0});cr.default=void 0;var qc=Mc(ot());function Mc(e){return e&&e.__esModule?e:{default:e}}var P=[];for(let e=0;e<256;++e)P.push((e+256).toString(16).substr(1));function Ic(e,t=0){let r=(P[e[t+0]]+P[e[t+1]]+P[e[t+2]]+P[e[t+3]]+"-"+P[e[t+4]]+P[e[t+5]]+"-"+P[e[t+6]]+P[e[t+7]]+"-"+P[e[t+8]]+P[e[t+9]]+"-"+P[e[t+10]]+P[e[t+11]]+P[e[t+12]]+P[e[t+13]]+P[e[t+14]]+P[e[t+15]]).toLowerCase();if(!(0,qc.default)(r))throw TypeError("Stringified UUID is invalid");return r}var Nc=Ic;cr.default=Nc});var pi=f(lr=>{"use strict";Object.defineProperty(lr,"__esModule",{value:!0});lr.default=void 0;var Lc=fi(os()),jc=fi(at());function fi(e){return e&&e.__esModule?e:{default:e}}var di,as,us=0,cs=0;function $c(e,t,r){let s=t&&r||0,i=t||new Array(16);e=e||{};let n=e.node||di,o=e.clockseq!==void 0?e.clockseq:as;if(n==null||o==null){let d=e.random||(e.rng||Lc.default)();n==null&&(n=di=[d[0]|1,d[1],d[2],d[3],d[4],d[5]]),o==null&&(o=as=(d[6]<<8|d[7])&16383)}let u=e.msecs!==void 0?e.msecs:Date.now(),a=e.nsecs!==void 0?e.nsecs:cs+1,h=u-us+(a-cs)/1e4;if(h<0&&e.clockseq===void 0&&(o=o+1&16383),(h<0||u>us)&&e.nsecs===void 0&&(a=0),a>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");us=u,cs=a,as=o,u+=122192928e5;let l=((u&268435455)*1e4+a)%4294967296;i[s++]=l>>>24&255,i[s++]=l>>>16&255,i[s++]=l>>>8&255,i[s++]=l&255;let c=u/4294967296*1e4&268435455;i[s++]=c>>>8&255,i[s++]=c&255,i[s++]=c>>>24&15|16,i[s++]=c>>>16&255,i[s++]=o>>>8|128,i[s++]=o&255;for(let d=0;d<6;++d)i[s+d]=n[d];return t||(0,jc.default)(i)}var Fc=$c;lr.default=Fc});var ls=f(hr=>{"use strict";Object.defineProperty(hr,"__esModule",{value:!0});hr.default=void 0;var Uc=kc(ot());function kc(e){return e&&e.__esModule?e:{default:e}}function Bc(e){if(!(0,Uc.default)(e))throw TypeError("Invalid UUID");let t,r=new Uint8Array(16);return r[0]=(t=parseInt(e.slice(0,8),16))>>>24,r[1]=t>>>16&255,r[2]=t>>>8&255,r[3]=t&255,r[4]=(t=parseInt(e.slice(9,13),16))>>>8,r[5]=t&255,r[6]=(t=parseInt(e.slice(14,18),16))>>>8,r[7]=t&255,r[8]=(t=parseInt(e.slice(19,23),16))>>>8,r[9]=t&255,r[10]=(t=parseInt(e.slice(24,36),16))/1099511627776&255,r[11]=t/4294967296&255,r[12]=t>>>24&255,r[13]=t>>>16&255,r[14]=t>>>8&255,r[15]=t&255,r}var Gc=Bc;hr.default=Gc});var hs=f(me=>{"use strict";Object.defineProperty(me,"__esModule",{value:!0});me.default=Kc;me.URL=me.DNS=void 0;var Vc=_i(at()),Wc=_i(ls());function _i(e){return e&&e.__esModule?e:{default:e}}function Yc(e){e=unescape(encodeURIComponent(e));let t=[];for(let r=0;r<e.length;++r)t.push(e.charCodeAt(r));return t}var gi="6ba7b810-9dad-11d1-80b4-00c04fd430c8";me.DNS=gi;var mi="6ba7b811-9dad-11d1-80b4-00c04fd430c8";me.URL=mi;function Kc(e,t,r){function s(i,n,o,u){if(typeof i=="string"&&(i=Yc(i)),typeof n=="string"&&(n=(0,Wc.default)(n)),n.length!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let a=new Uint8Array(16+i.length);if(a.set(n),a.set(i,n.length),a=r(a),a[6]=a[6]&15|t,a[8]=a[8]&63|128,o){u=u||0;for(let h=0;h<16;++h)o[u+h]=a[h];return o}return(0,Vc.default)(a)}try{s.name=e}catch{}return s.DNS=gi,s.URL=mi,s}});var vi=f(dr=>{"use strict";Object.defineProperty(dr,"__esModule",{value:!0});dr.default=void 0;var zc=Jc(require("crypto"));function Jc(e){return e&&e.__esModule?e:{default:e}}function Qc(e){return Array.isArray(e)?e=Buffer.from(e):typeof e=="string"&&(e=Buffer.from(e,"utf8")),zc.default.createHash("md5").update(e).digest()}var Xc=Qc;dr.default=Xc});var Ei=f(fr=>{"use strict";Object.defineProperty(fr,"__esModule",{value:!0});fr.default=void 0;var Zc=yi(hs()),el=yi(vi());function yi(e){return e&&e.__esModule?e:{default:e}}var tl=(0,Zc.default)("v3",48,el.default),rl=tl;fr.default=rl});var Ci=f(pr=>{"use strict";Object.defineProperty(pr,"__esModule",{value:!0});pr.default=void 0;var sl=Ri(os()),nl=Ri(at());function Ri(e){return e&&e.__esModule?e:{default:e}}function il(e,t,r){e=e||{};let s=e.random||(e.rng||sl.default)();if(s[6]=s[6]&15|64,s[8]=s[8]&63|128,t){r=r||0;for(let i=0;i<16;++i)t[r+i]=s[i];return t}return(0,nl.default)(s)}var ol=il;pr.default=ol});var bi=f(_r=>{"use strict";Object.defineProperty(_r,"__esModule",{value:!0});_r.default=void 0;var al=ul(require("crypto"));function ul(e){return e&&e.__esModule?e:{default:e}}function cl(e){return Array.isArray(e)?e=Buffer.from(e):typeof e=="string"&&(e=Buffer.from(e,"utf8")),al.default.createHash("sha1").update(e).digest()}var ll=cl;_r.default=ll});var wi=f(gr=>{"use strict";Object.defineProperty(gr,"__esModule",{value:!0});gr.default=void 0;var hl=Ai(hs()),dl=Ai(bi());function Ai(e){return e&&e.__esModule?e:{default:e}}var fl=(0,hl.default)("v5",80,dl.default),pl=fl;gr.default=pl});var Ti=f(mr=>{"use strict";Object.defineProperty(mr,"__esModule",{value:!0});mr.default=void 0;var _l="00000000-0000-0000-0000-000000000000";mr.default=_l});var Si=f(vr=>{"use strict";Object.defineProperty(vr,"__esModule",{value:!0});vr.default=void 0;var gl=ml(ot());function ml(e){return e&&e.__esModule?e:{default:e}}function vl(e){if(!(0,gl.default)(e))throw TypeError("Invalid UUID");return parseInt(e.substr(14,1),16)}var yl=vl;vr.default=yl});var xi=f(V=>{"use strict";Object.defineProperty(V,"__esModule",{value:!0});Object.defineProperty(V,"v1",{enumerable:!0,get:function(){return El.default}});Object.defineProperty(V,"v3",{enumerable:!0,get:function(){return Rl.default}});Object.defineProperty(V,"v4",{enumerable:!0,get:function(){return Cl.default}});Object.defineProperty(V,"v5",{enumerable:!0,get:function(){return bl.default}});Object.defineProperty(V,"NIL",{enumerable:!0,get:function(){return Al.default}});Object.defineProperty(V,"version",{enumerable:!0,get:function(){return wl.default}});Object.defineProperty(V,"validate",{enumerable:!0,get:function(){return Tl.default}});Object.defineProperty(V,"stringify",{enumerable:!0,get:function(){return Sl.default}});Object.defineProperty(V,"parse",{enumerable:!0,get:function(){return xl.default}});var El=J(pi()),Rl=J(Ei()),Cl=J(Ci()),bl=J(wi()),Al=J(Ti()),wl=J(Si()),Tl=J(ot()),Sl=J(at()),xl=J(ls());function J(e){return e&&e.__esModule?e:{default:e}}});var fs=f(ut=>{"use strict";var Hi=ut&&ut.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(ut,"__esModule",{value:!0});var Hl=Hi(require("url")),Ol=Hi(require("querystring")),ds=class{constructor(t,r,s){}cache(t){}redirect(t,r){}_readRedirectParams(t,r){let{statusCode:s=302,query:i={}}=typeof r=="number"?{statusCode:r}:r,n={},o=Hl.default.parse(t);return o!=null&&o.search&&(t=t.substr(0,t.length-o.search.length),n=Ol.default.parse(o.query)),{to:t,statusCode:s,query:{...n,...i}}}proxy(t,r){}render(t){}stream(t){}serveStatic(t,r){}updatePath(t){}rewrite(t,r){}setRequestHeader(t,r){}updateRequestHeader(t,r,s){}removeRequestHeader(t){}setUpstreamResponseHeader(t,r){}updateUpstreamResponseHeader(t,r,s){}removeUpstreamResponseHeader(t){}verifyJwt(t){}setResponseHeader(t,r){}updateResponseHeader(t,r,s){}removeResponseHeader(t){}addResponseCookie(t,r,s){}updateResponseCookie(t,r,s){}removeResponseCookie(t){}addUpstreamResponseCookie(t,r,s){}updateUpstreamResponseCookie(t,r,s){}removeUpstreamResponseCookie(t){}send(t,r,s){}compute(t){}serviceWorker(t){}allowCors(t){}appShell(t){}renderWithApp(t){}};ut.BaseResponseWriter=ds});var ct=f(ve=>{"use strict";Object.defineProperty(ve,"__esModule",{value:!0});var Pl=e=>e;function Dl(e,t,r=Pl){let s={};return Object.entries(e).every(([i,n])=>{let o=t[r(i)];if(n===null)return o===void 0;if(typeof n=="string"){if(typeof o=="string"&&Pi(n)){let u=Di(n);return s[u]=o,!0}n=new RegExp(`^${n}$`,"i")}return ps(n,o)})&&s}ve.matchCriteriaRegexObjectWithRequestObject=Dl;function Oi(e,t){return Object.entries(t).every(([r,s])=>{let i=e[r];return i?s instanceof RegExp?ps(s,i):typeof s=="object"&&s!==null?Oi(i,s):i==s:!1})}ve.deepMatchObject=Oi;function Pi(e){return typeof e=="string"&&/^:\w+$/.test(e)}ve.isParamMatcher=Pi;function Di(e){return e.slice(1)}ve.paramMatcherToParam=Di;function ps(e,t){return t==null?!1:(e.global&&(e=new RegExp(e)),Array.isArray(t)?t.some(r=>e.test(r)):e.test(t))}ve.testRegExp=ps});var gs=f(_s=>{"use strict";Object.defineProperty(_s,"__esModule",{value:!0});function ql(e,t){let r={};for(let[s,i]of Object.entries(e))r[s]=t(i,s);return r}_s.default=ql});var qi=f(lt=>{"use strict";var Ml=lt&&lt.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(lt,"__esModule",{value:!0});var Il=ct(),Nl=Ml(gs()),ue=class{constructor(t){this.entries=t||[]}get cacheableEntries(){return this.entries.filter(ue.isEntryCacheable)}get spaRoutes(){return this.cacheableEntries.filter(({cacheOptions:t})=>t.browser&&t.browser.spa).map(({route:t})=>new RegExp(t,"i"))}shouldPrefetch(t){let r=!1;return this.entries.some(s=>ue.entryMatches(s,t)?(r=ue.isEntryCacheable(s)||!!s.cacheOptions.prefetchUpstreamRequests,r||s.returnsResponse):!1),r}static entryMatches(t,r){return new RegExp(t.route,"i").test(r.pathname)&&Il.matchCriteriaRegexObjectWithRequestObject(Nl.default(t.query||{},s=>s?new RegExp(s,"i"):null),Object.fromEntries(Array.from(r.searchParams.entries())))&&(t.protocol?new RegExp(t.protocol,"i").test(r.protocol):!0)}static isEntryCacheable({cacheOptions:t}){return!!(t.browser&&(t.browser.serviceWorkerSeconds||0)>0&&t.edge&&(t.edge.maxAgeSeconds||0)>0)}static fromEntries(t){return new ue(t)}toJSON(){return JSON.stringify(this.entries)}};lt.default=ue});var Ii=f(ht=>{"use strict";var Mi=ht&&ht.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(ht,"__esModule",{value:!0});var Ll=fs(),jl=Mi(qi()),$l=Mi(gs());function Fl(e){let t=new jl.default,r=s=>{if(s!==void 0)return s instanceof RegExp?s.source:s};for(let s of e.routeGroups.getRoutes()){let i=new ms;s.handler(i);let n={criteriaPath:s.criteria.path,route:s.toRegexString(),method:r(s.criteria.method),protocol:r(s.criteria.protocol),cacheOptions:i.cacheOptions,returnsResponse:i.returnsResponse};s.criteria.query&&(n.query=$l.default(s.criteria.query,o=>o?o.source:null)),!(s.criteria.headers||s.criteria.cookies)&&t.entries.push(n)}return t}ht.default=Fl;var ms=class extends Ll.BaseResponseWriter{constructor(){super(...arguments),this.response={},this.request={},this.cacheOptions={},this.returnsResponse=!1,this.doesReturnResponse=()=>this.returnsResponse=!0,this.cache=t=>{this.cacheOptions=t},this.send=this.doesReturnResponse,this.compute=this.doesReturnResponse,this.proxy=this.doesReturnResponse,this.redirect=this.doesReturnResponse,this.render=this.doesReturnResponse,this.serveStatic=this.doesReturnResponse,this.serviceWorker=this.doesReturnResponse,this.renderWithApp=this.doesReturnResponse,this.appShell=this.doesReturnResponse,this.stream=this.doesReturnResponse}}});var $i=f((om,ji)=>{var Ul=require("path"),kl=60*60*24*365*10,Bl={edge:{maxAgeSeconds:kl},browser:!1},Ni="layer0_devtools_enabled",Gl="layer0_devtools_env_enabled";function Li(){return process.env.LAYER0_DEVTOOLS_ENABLED?process.env.LAYER0_DEVTOOLS_ENABLED==="true":process.env.PREVIEW_LAYER0_DEVTOOLS_ENABLED?process.env.PREVIEW_LAYER0_DEVTOOLS_ENABLED==="true":null}ji.exports=function({router:t,local:r}){Li()!==null&&t.match("/(.*)",({addResponseCookie:s})=>{s(Gl,`${Li()}; Path=/`)}),r&&t.get("/__layer0__/caching",s=>{s.send(JSON.stringify({local:r,enabled:process.env.LAYER0_CACHE==="true"}))}).post("/__layer0__/caching",s=>{let i=s.request.query;i&&(process.env.LAYER0_CACHE=i.enabled),s.send("done")}),t.get("/__layer0__/devtools/enable",({redirect:s,addResponseCookie:i})=>{i(Ni,"true; Path=/"),s("/")}).get("/__layer0__/devtools/disable",({redirect:s,addResponseCookie:i})=>{i(Ni,"false; Path=/"),s("/")}).match("/__layer0__/devtools/:path*",({cache:s,serveStatic:i})=>{s(Bl),i(Ul.join("node_modules","@layer0","devtools","widget",":path*"))})}});var Fi=f(dt=>{"use strict";var Vl=dt&&dt.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(dt,"__esModule",{value:!0});var Wl=Vl(Ii()),Yl=$e();function Kl(e){zl(e);try{$i()({router:e,local:Yl.isLocal()})}catch(t){if(t.code!=="MODULE_NOT_FOUND")throw t}}dt.default=Kl;function zl(e){e.match("/__layer0__/cache-manifest.js",({cache:t,setResponseHeader:r,send:s,allowCors:i})=>{t({edge:{maxAgeSeconds:60*60*24*365},browser:{maxAgeSeconds:60*60}}),r("content-type","text/javascript"),i(),s(()=>`self.__LAYER0_CACHE_MANIFEST__=${Wl.default(e).toJSON()}`)})}});var Ui=f(vs=>{"use strict";Object.defineProperty(vs,"__esModule",{value:!0});var Jl=new Set(["cache","setRequestHeader","updateRequestHeader","removeRequestHeader","setResponseHeader","updateResponseHeader","removeResponseHeader","setUpstreamResponseHeader","updateUpstreamResponseHeader","removeUpstreamResponseHeader","addResponseCookie","updateResponseCookie","removeResponseCookie","addUpstreamResponseCookie","updateUpstreamResponseCookie","removeUpstreamResponseCookie"]),Ql=e=>{let t=(r,s)=>async function(...i){if(!!r.runningImmediately)return await r[s](...i)}.bind(r);return new Proxy(e,{get:(r,s)=>s==="serveStatic"?Xl(r,r.serveStatic):Jl.has(s.toString())?t(r,s):r[s]})};vs.default={create:Ql};function Xl(e,t){return async(r,s={})=>{if(e.runningImmediately)return t.call(e,r,s);if(s.onNotFound)e.setCreateResponseAction(()=>e.runImmediately(()=>s.onNotFound(e)));else throw new Error("Should not get to serveStatic without onNotFound when running behind the edge.")}}});var yr=f(ys=>{"use strict";Object.defineProperty(ys,"__esModule",{value:!0});function Zl(e,t){let r=e,s=t.split(".");for(let i of s){if(typeof r>"u")return;r=r[i]}return r}ys.default=Zl});var ki=f(ft=>{"use strict";var eh=ft&&ft.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(ft,"__esModule",{value:!0});var th=eh(yr());function rh(e,t){return!!th.default(e,t)}ft.default=rh});var Wi=f((hm,Vi)=>{"use strict";var sh=function(t){return nh(t)&&!ih(t)};function nh(e){return!!e&&typeof e=="object"}function ih(e){var t=Object.prototype.toString.call(e);return t==="[object RegExp]"||t==="[object Date]"||uh(e)}var oh=typeof Symbol=="function"&&Symbol.for,ah=oh?Symbol.for("react.element"):60103;function uh(e){return e.$$typeof===ah}function ch(e){return Array.isArray(e)?[]:{}}function pt(e,t){return t.clone!==!1&&t.isMergeableObject(e)?Fe(ch(e),e,t):e}function lh(e,t,r){return e.concat(t).map(function(s){return pt(s,r)})}function hh(e,t){if(!t.customMerge)return Fe;var r=t.customMerge(e);return typeof r=="function"?r:Fe}function dh(e){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(e).filter(function(t){return e.propertyIsEnumerable(t)}):[]}function Bi(e){return Object.keys(e).concat(dh(e))}function Gi(e,t){try{return t in e}catch{return!1}}function fh(e,t){return Gi(e,t)&&!(Object.hasOwnProperty.call(e,t)&&Object.propertyIsEnumerable.call(e,t))}function ph(e,t,r){var s={};return r.isMergeableObject(e)&&Bi(e).forEach(function(i){s[i]=pt(e[i],r)}),Bi(t).forEach(function(i){fh(e,i)||(Gi(e,i)&&r.isMergeableObject(t[i])?s[i]=hh(i,r)(e[i],t[i],r):s[i]=pt(t[i],r))}),s}function Fe(e,t,r){r=r||{},r.arrayMerge=r.arrayMerge||lh,r.isMergeableObject=r.isMergeableObject||sh,r.cloneUnlessOtherwiseSpecified=pt;var s=Array.isArray(t),i=Array.isArray(e),n=s===i;return n?s?r.arrayMerge(e,t,r):ph(e,t,r):pt(t,r)}Fe.all=function(t,r){if(!Array.isArray(t))throw new Error("first argument should be an array");return t.reduce(function(s,i){return Fe(s,i,r)},{})};var _h=Fe;Vi.exports=_h});var Ji=f(_t=>{"use strict";var gh=_t&&_t.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(_t,"__esModule",{value:!0});var Yi=require("os"),Er=T(),mh=$e(),vh=gh(ae()),Cs={$id:"/domainOrIpSchema",type:"string"},Ki={$id:"/backendObjectSchema",type:"object",properties:{domainOrIp:{$ref:Cs.$id},port:{type:"number",minimum:1,maximum:65535},hostHeader:{type:"string"},disableCheckCert:{type:"boolean"},firstByteTimeout:{type:"number"},basePath:{type:"string"}},additionalProperties:!1,required:["domainOrIp"]},zi={$id:"/backendSchema",type:"object",patternProperties:{"^.*$":{oneOf:[{$ref:Cs.$id},{$ref:Ki.$id}]}}},Es={$id:"/layer0FileConfigurationSchema",type:"object",properties:{name:{type:"string"},team:{type:"string"},prerenderConcurrency:{type:"number"},production:{type:"boolean"},routes:{type:"string"},server:{type:"object",required:["path"],properties:{path:{type:"string"},export:{type:"string"}}},includeFiles:{type:"object"},sources:{type:"array",items:{type:"string"}},backends:{$ref:zi.$id},includeNodeModules:{type:"boolean"},connector:{type:"string"}},additionalProperties:!1,required:[]},Rs=class{static validateLayer0FileConfiguration(t){if(mh.isCloud())return t;let r=vh.default("ajv");if(t.connector)try{let o=require(`${t.connector}/configSchema`);Object.assign(Es.properties,o)}catch{}let s=new r({allErrors:!0,schemas:[Es,zi,Ki,Cs]}),i=[],n=s.getSchema(Es.$id);if(t.backends&&t.backends.moov!=null&&i.push({message:"is a reserved backend name",dataPath:".backends['moov']"}),t.backends&&t.backends[Er.BACKENDS.static]&&i.push({message:"is a reserved backend name",dataPath:`.backends.${Er.BACKENDS.static}`}),t.backends&&t.backends[Er.BACKENDS.js]&&i.push({message:"is a reserved backend name",dataPath:`.backends.${Er.BACKENDS.js}`}),!n(t)&&n.errors&&(i=[...i,...n.errors]),i.length){let o=i.map((u,a)=>{let h=`${a+1}) config${u.dataPath}: ${u.message}`;return u.keyword==="additionalProperties"&&(h+=` '${u.params.additionalProperty}'`),h}).join(Yi.EOL);throw new Error(`Layer0 configuration validation failed with errors: ${Yi.EOL}${o}`)}return t}};_t.default=Rs});var ye=f(mt=>{"use strict";var vt=mt&&mt.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(mt,"__esModule",{value:!0});var yh=vt(yr()),Eh=vt(ki()),Rh=vt(Wi()),Qi=require("fs"),bs=require("path"),gt=T(),Ch=vt(Ji()),bh=vt(ae()),As=class{constructor(){this.defaults={production:!0,backends:{},includeNodeModules:!1,routes:["routes.js","routes.ts","routes.cjs"].find(t=>Qi.existsSync(bs.join(process.cwd(),t)))||"routes.js"}}get(t,r){if(this.has(t))return yh.default(this.values,t);if(typeof r<"u")return r;throw new Error(`Layer0 configuration key: "${t}" is not defined`)}has(t){return this.values||this.loadLayer0Config(),Eh.default(this.values,t)}get all(){return this.values||this.loadLayer0Config(),this.values}loadLayer0Config(){let t=this.loadFromFile(),r=this.loadFromEnv();this.values=Rh.default.all([{},this.defaults,t,r])}loadFromFile(){let t=[bs.join(process.cwd(),gt.LAYER0_CONFIG_FILE),bs.join(process.cwd(),gt.LAYER0_CONFIG_FILE.replace(".js",".cjs"))].find(Qi.existsSync);if(t)try{let r=bh.default(t);return Ch.default.validateLayer0FileConfiguration(r)}catch(r){throw new Error(`Failed to load ${t}: ${r.message}`)}return{}}loadFromEnv(){if(process.env[gt.LAYER0_ENV_VARIABLES.config])try{return JSON.parse(process.env[gt.LAYER0_ENV_VARIABLES.config])}catch{throw new Error(`Layer0 configuration variable: ${gt.LAYER0_ENV_VARIABLES.config}, is not parsable as json`)}return{}}};mt.default=new As});var Cr=f(Rr=>{"use strict";Object.defineProperty(Rr,"__esModule",{value:!0});function Ah(e){return`${e.ignoreCase?"(?i)":""}${e.source}`.replace(/\\\//g,"/")}Rr.default=Ah;function wh(e){let t=e.indexOf("(?i)")===0;return t&&(e=e.slice(4)),new RegExp(e.replace(/\//g,"/"),t?"i":"")}Rr.fromEdgeRegex=wh});var Xi=f(ws=>{"use strict";Object.defineProperty(ws,"__esModule",{value:!0});function Th(e){return new RegExp(`^${e}$`,"i")}ws.default=Th});var eo=f(yt=>{"use strict";var Sh=yt&&yt.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(yt,"__esModule",{value:!0});var Zi=Sh(Cr());function xh(e){let t;return e===null?t=null:typeof e=="string"?t=Zi.default(new RegExp(`^${e}$`,"i")):t=Zi.default(e),t}yt.default=xh});var Ss=f(Ts=>{"use strict";Object.defineProperty(Ts,"__esModule",{value:!0});Ts.default=(e,t)=>{let r=e;if(/(^|[^$]){/.test(e))throw new Error(`{variable} syntax in the path option is no longer supported, use :variable instead (${e})`);for(let s in t){let i=t[s];Array.isArray(i)&&(i=i.join("/")),r=r.replace(new RegExp(`:${s}(\\([^)]*\\))?[?*+]?`,"g"),i===void 0?"":i)}return r=r.replace(/:\w+(\*|\+|\?)?/,""),r=r.replace("\\?","?"),r=r.replace(/\/+/g,"/").replace(/^([^:]+:)\//gi,"$1//"),r}});var br=f(q=>{"use strict";Object.defineProperty(q,"__esModule",{value:!0});q.pathToRegexp=q.tokensToRegexp=q.regexpToFunction=q.match=q.tokensToFunction=q.compile=q.parse=void 0;function Hh(e){for(var t=[],r=0;r<e.length;){var s=e[r];if(s==="*"||s==="+"||s==="?"){t.push({type:"MODIFIER",index:r,value:e[r++]});continue}if(s==="\\"){t.push({type:"ESCAPED_CHAR",index:r++,value:e[r++]});continue}if(s==="{"){t.push({type:"OPEN",index:r,value:e[r++]});continue}if(s==="}"){t.push({type:"CLOSE",index:r,value:e[r++]});continue}if(s===":"){for(var i="",n=r+1;n<e.length;){var o=e.charCodeAt(n);if(o>=48&&o<=57||o>=65&&o<=90||o>=97&&o<=122||o===95){i+=e[n++];continue}break}if(!i)throw new TypeError("Missing parameter name at ".concat(r));t.push({type:"NAME",index:r,value:i}),r=n;continue}if(s==="("){var u=1,a="",n=r+1;if(e[n]==="?")throw new TypeError('Pattern cannot start with "?" at '.concat(n));for(;n<e.length;){if(e[n]==="\\"){a+=e[n++]+e[n++];continue}if(e[n]===")"){if(u--,u===0){n++;break}}else if(e[n]==="("&&(u++,e[n+1]!=="?"))throw new TypeError("Capturing groups are not allowed at ".concat(n));a+=e[n++]}if(u)throw new TypeError("Unbalanced pattern at ".concat(r));if(!a)throw new TypeError("Missing pattern at ".concat(r));t.push({type:"PATTERN",index:r,value:a}),r=n;continue}t.push({type:"CHAR",index:r,value:e[r++]})}return t.push({type:"END",index:r,value:""}),t}function xs(e,t){t===void 0&&(t={});for(var r=Hh(e),s=t.prefixes,i=s===void 0?"./":s,n="[^".concat(Ue(t.delimiter||"/#?"),"]+?"),o=[],u=0,a=0,h="",l=function(O){if(a<r.length&&r[a].type===O)return r[a++].value},c=function(O){var z=l(O);if(z!==void 0)return z;var K=r[a],nt=K.type,Qr=K.index;throw new TypeError("Unexpected ".concat(nt," at ").concat(Qr,", expected ").concat(O))},d=function(){for(var O="",z;z=l("CHAR")||l("ESCAPED_CHAR");)O+=z;return O};a<r.length;){var p=l("CHAR"),_=l("NAME"),g=l("PATTERN");if(_||g){var m=p||"";i.indexOf(m)===-1&&(h+=m,m=""),h&&(o.push(h),h=""),o.push({name:_||u++,prefix:m,suffix:"",pattern:g||n,modifier:l("MODIFIER")||""});continue}var b=p||l("ESCAPED_CHAR");if(b){h+=b;continue}h&&(o.push(h),h="");var N=l("OPEN");if(N){var m=d(),pe=l("NAME")||"",C=l("PATTERN")||"",oe=d();c("CLOSE"),o.push({name:pe||(C?u++:""),pattern:pe&&!C?n:C,prefix:m,suffix:oe,modifier:l("MODIFIER")||""});continue}c("END")}return o}q.parse=xs;function Oh(e,t){return to(xs(e,t),t)}q.compile=Oh;function to(e,t){t===void 0&&(t={});var r=Hs(t),s=t.encode,i=s===void 0?function(a){return a}:s,n=t.validate,o=n===void 0?!0:n,u=e.map(function(a){if(typeof a=="object")return new RegExp("^(?:".concat(a.pattern,")$"),r)});return function(a){for(var h="",l=0;l<e.length;l++){var c=e[l];if(typeof c=="string"){h+=c;continue}var d=a?a[c.name]:void 0,p=c.modifier==="?"||c.modifier==="*",_=c.modifier==="*"||c.modifier==="+";if(Array.isArray(d)){if(!_)throw new TypeError('Expected "'.concat(c.name,'" to not repeat, but got an array'));if(d.length===0){if(p)continue;throw new TypeError('Expected "'.concat(c.name,'" to not be empty'))}for(var g=0;g<d.length;g++){var m=i(d[g],c);if(o&&!u[l].test(m))throw new TypeError('Expected all "'.concat(c.name,'" to match "').concat(c.pattern,'", but got "').concat(m,'"'));h+=c.prefix+m+c.suffix}continue}if(typeof d=="string"||typeof d=="number"){var m=i(String(d),c);if(o&&!u[l].test(m))throw new TypeError('Expected "'.concat(c.name,'" to match "').concat(c.pattern,'", but got "').concat(m,'"'));h+=c.prefix+m+c.suffix;continue}if(!p){var b=_?"an array":"a string";throw new TypeError('Expected "'.concat(c.name,'" to be ').concat(b))}}return h}}q.tokensToFunction=to;function Ph(e,t){var r=[],s=Os(e,r,t);return ro(s,r,t)}q.match=Ph;function ro(e,t,r){r===void 0&&(r={});var s=r.decode,i=s===void 0?function(n){return n}:s;return function(n){var o=e.exec(n);if(!o)return!1;for(var u=o[0],a=o.index,h=Object.create(null),l=function(d){if(o[d]===void 0)return"continue";var p=t[d-1];p.modifier==="*"||p.modifier==="+"?h[p.name]=o[d].split(p.prefix+p.suffix).map(function(_){return i(_,p)}):h[p.name]=i(o[d],p)},c=1;c<o.length;c++)l(c);return{path:u,index:a,params:h}}}q.regexpToFunction=ro;function Ue(e){return e.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}function Hs(e){return e&&e.sensitive?"":"i"}function Dh(e,t){if(!t)return e;for(var r=/\((?:\?<(.*?)>)?(?!\?)/g,s=0,i=r.exec(e.source);i;)t.push({name:i[1]||s++,prefix:"",suffix:"",modifier:"",pattern:""}),i=r.exec(e.source);return e}function qh(e,t,r){var s=e.map(function(i){return Os(i,t,r).source});return new RegExp("(?:".concat(s.join("|"),")"),Hs(r))}function Mh(e,t,r){return so(xs(e,r),t,r)}function so(e,t,r){r===void 0&&(r={});for(var s=r.strict,i=s===void 0?!1:s,n=r.start,o=n===void 0?!0:n,u=r.end,a=u===void 0?!0:u,h=r.encode,l=h===void 0?function(Qr){return Qr}:h,c=r.delimiter,d=c===void 0?"/#?":c,p=r.endsWith,_=p===void 0?"":p,g="[".concat(Ue(_),"]|$"),m="[".concat(Ue(d),"]"),b=o?"^":"",N=0,pe=e;N<pe.length;N++){var C=pe[N];if(typeof C=="string")b+=Ue(l(C));else{var oe=Ue(l(C.prefix)),O=Ue(l(C.suffix));if(C.pattern)if(t&&t.push(C),oe||O)if(C.modifier==="+"||C.modifier==="*"){var z=C.modifier==="*"?"?":"";b+="(?:".concat(oe,"((?:").concat(C.pattern,")(?:").concat(O).concat(oe,"(?:").concat(C.pattern,"))*)").concat(O,")").concat(z)}else b+="(?:".concat(oe,"(").concat(C.pattern,")").concat(O,")").concat(C.modifier);else C.modifier==="+"||C.modifier==="*"?b+="((?:".concat(C.pattern,")").concat(C.modifier,")"):b+="(".concat(C.pattern,")").concat(C.modifier);else b+="(?:".concat(oe).concat(O,")").concat(C.modifier)}}if(a)i||(b+="".concat(m,"?")),b+=r.endsWith?"(?=".concat(g,")"):"$";else{var K=e[e.length-1],nt=typeof K=="string"?m.indexOf(K[K.length-1])>-1:K===void 0;i||(b+="(?:".concat(m,"(?=").concat(g,"))?")),nt||(b+="(?=".concat(m,"|").concat(g,")"))}return new RegExp(b,Hs(r))}q.tokensToRegexp=so;function Os(e,t,r){return e instanceof RegExp?Dh(e,t):Array.isArray(e)?qh(e,t,r):Mh(e,t,r)}q.pathToRegexp=Os});var io=f(ke=>{"use strict";var Ih=ke&&ke.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(ke,"__esModule",{value:!0});var Nh=Ih(Ss()),Lh=br();function jh(e,t){if(e==null)return t;let r=no(e);return Nh.default(t,r)}ke.default=jh;function no(e){if(!e)return{};let t=e.match(/https?:\/\/[^/]+(.*)/);t&&(e=`/${t[1]}`);let r=1,s={};return Lh.parse(e).forEach(i=>{typeof i!="string"&&(s[i.name]=`\\${r++}`)}),s}ke.getBackReferences=no});var oo=f(Ps=>{"use strict";Object.defineProperty(Ps,"__esModule",{value:!0});function $h(e){return e?typeof e.length=="number"?!e.length:!(typeof e=="object"&&Object.keys(e).length):!0}Ps.default=$h});var ao=f(qs=>{"use strict";Object.defineProperty(qs,"__esModule",{value:!0});var Ds=class extends Error{constructor(t){super(t.message),this.type="BackendFetchError",this.cause=t}};qs.default=Ds});var Ns=f(Is=>{"use strict";Object.defineProperty(Is,"__esModule",{value:!0});var Ms="__";function Fh(e,t){let r=new URL(e,`https://${Ms}`).searchParams,s=new URL(t,`https://${Ms}`);return r.forEach((i,n)=>{s.searchParams.get(n)||s.searchParams.set(n,i)}),s.hostname===Ms?`${s.pathname}${s.search}`:s.toString()}Is.default=Fh});var fo=f(Et=>{"use strict";var wr=Et&&Et.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Et,"__esModule",{value:!0});var Uh=require("url"),uo=wr(require("https")),kh=wr(require("http")),co=require("path"),Ls=wr(ao()),Bh=wr(Ns()),lo=T(),Gh=["transfer-encoding","content-length"],Ar=class{constructor(t){this.config=t}static setImpl(t){ho=t}static create(t){return new ho(t)}async fetch(t,r,s){let{path:i,headers:n}=s||{},o=this.getProxyTarget(t,i),u=this.getProxyRequestOptions(o,t,n,s==null?void 0:s.removeEmptySearchParamValues);return new Promise((a,h)=>{let c=(o.protocol==="https:"?uo.default:kh.default).request(u,d=>{let p=[];d.on("data",_=>p.push(_)).on("end",()=>{d.complete&&(Object.entries(d.headers).filter(([_])=>!Gh.includes(_.toLowerCase())).forEach(([_,g])=>{try{r.setHeader(_,g)}catch(m){console.warn(`Could not relay upstream response header ${_} with value ${g}`,m)}}),r.statusCode=d.statusCode,r.statusMessage=d.statusMessage,r.body=Buffer.concat(p),process.env.DEBUG==="true"&&console.log("proxy",`[${r.statusCode} ${r.statusMessage}]`,o),a(void 0))}).on("error",_=>{h(new Ls.default(_))}).on("close",()=>{d.complete||h(new Ls.default(new Error("The connection was terminated while the message was still being sent")))})});c.on("error",d=>h(new Ls.default(d))),c.end(t.rawBody)})}getProxyTarget(t,r){let s=r?Bh.default(t.url,r):t.url,{domainOrIp:i,basePath:n,port:o}=this.config;if(n&&(s=co.join(n,s)),i){let a=i.match(/^(127.0.0.1|localhost)(:\d+)?$/)?"http":"https",h=`${i}${o?`:${o}`:""}`;s=`${a}://${co.join(h,s)}`}let u=Uh.parse(s,!0);return t.getHeader(lo.HTTP_HEADERS.x0Protocol)==="http"&&(u.protocol="http:"),u}isLocal(t){return t.hostname===lo.JS_BACKEND_HOSTNAME}getProxyRequestOptions(t,r,s,i){let n=null;this.config.disableCheckCert&&t.protocol==="https:"&&(n=new uo.default.Agent({rejectUnauthorized:!1}));let o={...r.headers,...s,host:this.config.hostHeader||r.headers.host};this.isLocal(t)&&(o["x-forwarded-proto"]=r.secure?"https":"http");let u=t.path;return i===!0&&u&&(u=u.replace(/=(?=&|$)/gm,"")),{...t,path:u,method:r.method,timeout:this.config.firstByteTimeout||0,agent:n,body:r.rawBody,headers:o}}};Et.default=Ar;var ho=Ar});var Sr=f(js=>{"use strict";js.parse=Yh;js.serialize=Kh;var Vh=decodeURIComponent,Wh=encodeURIComponent,Tr=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/;function Yh(e,t){if(typeof e!="string")throw new TypeError("argument str must be a string");for(var r={},s=t||{},i=e.split(";"),n=s.decode||Vh,o=0;o<i.length;o++){var u=i[o],a=u.indexOf("=");if(!(a<0)){var h=u.substring(0,a).trim();if(r[h]==null){var l=u.substring(a+1,u.length).trim();l[0]==='"'&&(l=l.slice(1,-1)),r[h]=zh(l,n)}}}return r}function Kh(e,t,r){var s=r||{},i=s.encode||Wh;if(typeof i!="function")throw new TypeError("option encode is invalid");if(!Tr.test(e))throw new TypeError("argument name is invalid");var n=i(t);if(n&&!Tr.test(n))throw new TypeError("argument val is invalid");var o=e+"="+n;if(s.maxAge!=null){var u=s.maxAge-0;if(isNaN(u)||!isFinite(u))throw new TypeError("option maxAge is invalid");o+="; Max-Age="+Math.floor(u)}if(s.domain){if(!Tr.test(s.domain))throw new TypeError("option domain is invalid");o+="; Domain="+s.domain}if(s.path){if(!Tr.test(s.path))throw new TypeError("option path is invalid");o+="; Path="+s.path}if(s.expires){if(typeof s.expires.toUTCString!="function")throw new TypeError("option expires is invalid");o+="; Expires="+s.expires.toUTCString()}if(s.httpOnly&&(o+="; HttpOnly"),s.secure&&(o+="; Secure"),s.sameSite){var a=typeof s.sameSite=="string"?s.sameSite.toLowerCase():s.sameSite;switch(a){case!0:o+="; SameSite=Strict";break;case"lax":o+="; SameSite=Lax";break;case"strict":o+="; SameSite=Strict";break;case"none":o+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}}return o}function zh(e,t){try{return t(e)}catch{return e}}});var po=f($s=>{"use strict";Object.defineProperty($s,"__esModule",{value:!0});function Jh(e){return e}$s.default=Jh});var Fs=f(Rt=>{"use strict";var _o=Rt&&Rt.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Rt,"__esModule",{value:!0});var Qh=_o(Sr()),Xh=require("querystring"),Zh=_o(po());function go(e,t,r){if(typeof r=="string")return ed(e,t,r);if(!Array.isArray(r))return r;let s=[];return r.forEach(i=>{s.push(go(e,t,i))}),s}Rt.default=go;function ed(e,t,r){let s=r.replace(/\\\${/g,"--backslashdollar--").replace(/\${/g,"--separator--${").split("--separator--"),i={};e!=null&&e.headers.cookie&&(i=Qh.default.parse(e.headers.cookie,{decode:Zh.default}));let n={};if(e!=null&&e.url){let h=e.url.indexOf("?");if(h>=0){let l=e.url.substring(h+1);n=Xh.parse(l)}}let o=[],u=6,a=8;return s.forEach(h=>{if(e){h=h.replace(/\${method}/,e.method),h=h.replace(/\${path}/,e.path),h=h.replace(/\${url}/,e.url);let c=h.search(/\${query:/);if(c>=0){let p=h.substring(c+a),_=p.indexOf("}");if(_<=0)throw new Error(`Cannot interpolate substring "${h}" of value "${r}" (1)`);p=p.substring(0,_);let g=n[p]||"";Array.isArray(g)&&(g=g[0]),h=h.replace(/\${query:.*?}/,g)}let d=h.search(/\${req:/);if(d>=0){let p=h.substring(d+u),_=p.indexOf("}");if(_<=0)throw new Error(`Cannot interpolate substring "${h}" of value "${r}" (2)`);p=p.substring(0,_);let g="";if(p.indexOf("cookie:")===0){let m=p.split(":")[1];g=i[m]||""}else if(p.indexOf("param:")===0){let m=p.split(":")[1];e.params&&e.params[m]&&(g=String(e.params[m]))}else g=e.headers[p]||"";h=h.replace(/\${req:.*?}/,g)}}let l=h.search(/\${res:/);if(l>=0){if(!t)throw new Error(`Cannot interpolate response parameter "${h}" during receive phase`);let c=h.substring(l+u),d=c.indexOf("}");if(d<=0)throw new Error(`Cannot interpolate substring "${h}" of value "${r}" (3)`);c=c.substring(0,d),h=h.replace(/\${res:.*?}/,t.getHeader(c)||"")}if(h.search(/\${/)>=0)throw new Error(`Cannot interpolate substring "${h}" of "${r}" (4)`);o.push(h)}),o.join("").replace(/--backslashdollar--/g,"${")}});var vo=f((Sm,Us)=>{"use strict";var td=Object.prototype.hasOwnProperty,L="~";function Ct(){}Object.create&&(Ct.prototype=Object.create(null),new Ct().__proto__||(L=!1));function rd(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function mo(e,t,r,s,i){if(typeof r!="function")throw new TypeError("The listener must be a function");var n=new rd(r,s||e,i),o=L?L+t:t;return e._events[o]?e._events[o].fn?e._events[o]=[e._events[o],n]:e._events[o].push(n):(e._events[o]=n,e._eventsCount++),e}function xr(e,t){--e._eventsCount===0?e._events=new Ct:delete e._events[t]}function M(){this._events=new Ct,this._eventsCount=0}M.prototype.eventNames=function(){var t=[],r,s;if(this._eventsCount===0)return t;for(s in r=this._events)td.call(r,s)&&t.push(L?s.slice(1):s);return Object.getOwnPropertySymbols?t.concat(Object.getOwnPropertySymbols(r)):t};M.prototype.listeners=function(t){var r=L?L+t:t,s=this._events[r];if(!s)return[];if(s.fn)return[s.fn];for(var i=0,n=s.length,o=new Array(n);i<n;i++)o[i]=s[i].fn;return o};M.prototype.listenerCount=function(t){var r=L?L+t:t,s=this._events[r];return s?s.fn?1:s.length:0};M.prototype.emit=function(t,r,s,i,n,o){var u=L?L+t:t;if(!this._events[u])return!1;var a=this._events[u],h=arguments.length,l,c;if(a.fn){switch(a.once&&this.removeListener(t,a.fn,void 0,!0),h){case 1:return a.fn.call(a.context),!0;case 2:return a.fn.call(a.context,r),!0;case 3:return a.fn.call(a.context,r,s),!0;case 4:return a.fn.call(a.context,r,s,i),!0;case 5:return a.fn.call(a.context,r,s,i,n),!0;case 6:return a.fn.call(a.context,r,s,i,n,o),!0}for(c=1,l=new Array(h-1);c<h;c++)l[c-1]=arguments[c];a.fn.apply(a.context,l)}else{var d=a.length,p;for(c=0;c<d;c++)switch(a[c].once&&this.removeListener(t,a[c].fn,void 0,!0),h){case 1:a[c].fn.call(a[c].context);break;case 2:a[c].fn.call(a[c].context,r);break;case 3:a[c].fn.call(a[c].context,r,s);break;case 4:a[c].fn.call(a[c].context,r,s,i);break;default:if(!l)for(p=1,l=new Array(h-1);p<h;p++)l[p-1]=arguments[p];a[c].fn.apply(a[c].context,l)}}return!0};M.prototype.on=function(t,r,s){return mo(this,t,r,s,!1)};M.prototype.once=function(t,r,s){return mo(this,t,r,s,!0)};M.prototype.removeListener=function(t,r,s,i){var n=L?L+t:t;if(!this._events[n])return this;if(!r)return xr(this,n),this;var o=this._events[n];if(o.fn)o.fn===r&&(!i||o.once)&&(!s||o.context===s)&&xr(this,n);else{for(var u=0,a=[],h=o.length;u<h;u++)(o[u].fn!==r||i&&!o[u].once||s&&o[u].context!==s)&&a.push(o[u]);a.length?this._events[n]=a.length===1?a[0]:a:xr(this,n)}return this};M.prototype.removeAllListeners=function(t){var r;return t?(r=L?L+t:t,this._events[r]&&xr(this,r)):(this._events=new Ct,this._eventsCount=0),this};M.prototype.off=M.prototype.removeListener;M.prototype.addListener=M.prototype.on;M.prefixed=L;M.EventEmitter=M;typeof Us<"u"&&(Us.exports=M)});var Eo=f((xm,yo)=>{"use strict";yo.exports=function(t,r){if(r=r.split(":")[0],t=+t,!t)return!1;switch(r){case"http":case"ws":return t!==80;case"https":case"wss":return t!==443;case"ftp":return t!==21;case"gopher":return t!==70;case"file":return!1}return t!==0}});var Hr=f(Co=>{var Q=Co,sd=require("url"),Ro=require("util")._extend,nd=Eo(),id=/(^|,)\s*upgrade\s*($|,)/i,ks=/^https|wss/;Q.isSSL=ks;Q.setupOutgoing=function(e,t,r,s){e.port=t[s||"target"].port||(ks.test(t[s||"target"].protocol)?443:80),["host","hostname","socketPath","pfx","key","passphrase","cert","ca","ciphers","secureProtocol"].forEach(function(u){e[u]=t[s||"target"][u]}),e.method=t.method||r.method,e.headers=Ro({},r.headers),t.headers&&Ro(e.headers,t.headers),t.auth&&(e.auth=t.auth),t.ca&&(e.ca=t.ca),ks.test(t[s||"target"].protocol)&&(e.rejectUnauthorized=typeof t.secure>"u"?!0:t.secure),e.agent=t.agent||!1,e.localAddress=t.localAddress,e.agent||(e.headers=e.headers||{},(typeof e.headers.connection!="string"||!id.test(e.headers.connection))&&(e.headers.connection="close"));var i=t[s||"target"],n=i&&t.prependPath!==!1&&i.path||"",o=t.toProxy?r.url:sd.parse(r.url).path||"";return o=t.ignorePath?"":o,e.path=Q.urlJoin(n,o),t.changeOrigin&&(e.headers.host=nd(e.port,t[s||"target"].protocol)&&!od(e.host)?e.host+":"+e.port:e.host),e};Q.setupSocket=function(e){return e.setTimeout(0),e.setNoDelay(!0),e.setKeepAlive(!0,0),e};Q.getPort=function(e){var t=e.headers.host?e.headers.host.match(/:(\d+)/):"";return t?t[1]:Q.hasEncryptedConnection(e)?"443":"80"};Q.hasEncryptedConnection=function(e){return Boolean(e.connection.encrypted||e.connection.pair)};Q.urlJoin=function(){var e=Array.prototype.slice.call(arguments),t=e.length-1,r=e[t],s=r.split("?"),i;return e[t]=s.shift(),i=[e.filter(Boolean).join("/").replace(/\/+/g,"/").replace("http:/","http://").replace("https:/","https://")],i.push.apply(i,s),i.join("?")};Q.rewriteCookieProperty=function e(t,r,s){return Array.isArray(t)?t.map(function(i){return e(i,r,s)}):t.replace(new RegExp("(;\\s*"+s+"=)([^;]+)","i"),function(i,n,o){var u;if(o in r)u=r[o];else if("*"in r)u=r["*"];else return i;return u?n+u:""})};function od(e){return!!~e.indexOf(":")}});var To=f((Om,wo)=>{var bo=require("url"),Ao=Hr(),ad=/^201|30(1|2|7|8)$/;wo.exports={removeChunked:function(t,r,s){t.httpVersion==="1.0"&&delete s.headers["transfer-encoding"]},setConnection:function(t,r,s){t.httpVersion==="1.0"?s.headers.connection=t.headers.connection||"close":t.httpVersion!=="2.0"&&!s.headers.connection&&(s.headers.connection=t.headers.connection||"keep-alive")},setRedirectHostRewrite:function(t,r,s,i){if((i.hostRewrite||i.autoRewrite||i.protocolRewrite)&&s.headers.location&&ad.test(s.statusCode)){var n=bo.parse(i.target),o=bo.parse(s.headers.location);if(n.host!=o.host)return;i.hostRewrite?o.host=i.hostRewrite:i.autoRewrite&&(o.host=t.headers.host),i.protocolRewrite&&(o.protocol=i.protocolRewrite),s.headers.location=o.format()}},writeHeaders:function(t,r,s,i){var n=i.cookieDomainRewrite,o=i.cookiePathRewrite,u=i.preserveHeaderKeyCase,a,h=function(d,p){p!=null&&(n&&d.toLowerCase()==="set-cookie"&&(p=Ao.rewriteCookieProperty(p,n,"domain")),o&&d.toLowerCase()==="set-cookie"&&(p=Ao.rewriteCookieProperty(p,o,"path")),r.setHeader(String(d).trim(),p))};if(typeof n=="string"&&(n={"*":n}),typeof o=="string"&&(o={"*":o}),u&&s.rawHeaders!=null){a={};for(var l=0;l<s.rawHeaders.length;l+=2){var c=s.rawHeaders[l];a[c.toLowerCase()]=c}}Object.keys(s.headers).forEach(function(d){var p=s.headers[d];u&&a&&(d=a[d]||d),h(d,p)})},writeStatusCode:function(t,r,s){s.statusMessage?(r.statusCode=s.statusCode,r.statusMessage=s.statusMessage):r.statusCode=s.statusCode}}});var xo=f((Pm,So)=>{var Be=1e3,Ge=Be*60,Ve=Ge*60,Ee=Ve*24,ud=Ee*7,cd=Ee*365.25;So.exports=function(e,t){t=t||{};var r=typeof e;if(r==="string"&&e.length>0)return ld(e);if(r==="number"&&isFinite(e))return t.long?dd(e):hd(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))};function ld(e){if(e=String(e),!(e.length>100)){var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(!!t){var r=parseFloat(t[1]),s=(t[2]||"ms").toLowerCase();switch(s){case"years":case"year":case"yrs":case"yr":case"y":return r*cd;case"weeks":case"week":case"w":return r*ud;case"days":case"day":case"d":return r*Ee;case"hours":case"hour":case"hrs":case"hr":case"h":return r*Ve;case"minutes":case"minute":case"mins":case"min":case"m":return r*Ge;case"seconds":case"second":case"secs":case"sec":case"s":return r*Be;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return}}}}function hd(e){var t=Math.abs(e);return t>=Ee?Math.round(e/Ee)+"d":t>=Ve?Math.round(e/Ve)+"h":t>=Ge?Math.round(e/Ge)+"m":t>=Be?Math.round(e/Be)+"s":e+"ms"}function dd(e){var t=Math.abs(e);return t>=Ee?Or(e,t,Ee,"day"):t>=Ve?Or(e,t,Ve,"hour"):t>=Ge?Or(e,t,Ge,"minute"):t>=Be?Or(e,t,Be,"second"):e+" ms"}function Or(e,t,r,s){var i=t>=r*1.5;return Math.round(e/r)+" "+s+(i?"s":"")}});var Bs=f((Dm,Ho)=>{function fd(e){r.debug=r,r.default=r,r.coerce=a,r.disable=n,r.enable=i,r.enabled=o,r.humanize=xo(),r.destroy=h,Object.keys(e).forEach(l=>{r[l]=e[l]}),r.names=[],r.skips=[],r.formatters={};function t(l){let c=0;for(let d=0;d<l.length;d++)c=(c<<5)-c+l.charCodeAt(d),c|=0;return r.colors[Math.abs(c)%r.colors.length]}r.selectColor=t;function r(l){let c,d=null,p,_;function g(...m){if(!g.enabled)return;let b=g,N=Number(new Date),pe=N-(c||N);b.diff=pe,b.prev=c,b.curr=N,c=N,m[0]=r.coerce(m[0]),typeof m[0]!="string"&&m.unshift("%O");let C=0;m[0]=m[0].replace(/%([a-zA-Z%])/g,(O,z)=>{if(O==="%%")return"%";C++;let K=r.formatters[z];if(typeof K=="function"){let nt=m[C];O=K.call(b,nt),m.splice(C,1),C--}return O}),r.formatArgs.call(b,m),(b.log||r.log).apply(b,m)}return g.namespace=l,g.useColors=r.useColors(),g.color=r.selectColor(l),g.extend=s,g.destroy=r.destroy,Object.defineProperty(g,"enabled",{enumerable:!0,configurable:!1,get:()=>d!==null?d:(p!==r.namespaces&&(p=r.namespaces,_=r.enabled(l)),_),set:m=>{d=m}}),typeof r.init=="function"&&r.init(g),g}function s(l,c){let d=r(this.namespace+(typeof c>"u"?":":c)+l);return d.log=this.log,d}function i(l){r.save(l),r.namespaces=l,r.names=[],r.skips=[];let c,d=(typeof l=="string"?l:"").split(/[\s,]+/),p=d.length;for(c=0;c<p;c++)!d[c]||(l=d[c].replace(/\*/g,".*?"),l[0]==="-"?r.skips.push(new RegExp("^"+l.slice(1)+"$")):r.names.push(new RegExp("^"+l+"$")))}function n(){let l=[...r.names.map(u),...r.skips.map(u).map(c=>"-"+c)].join(",");return r.enable(""),l}function o(l){if(l[l.length-1]==="*")return!0;let c,d;for(c=0,d=r.skips.length;c<d;c++)if(r.skips[c].test(l))return!1;for(c=0,d=r.names.length;c<d;c++)if(r.names[c].test(l))return!0;return!1}function u(l){return l.toString().substring(2,l.toString().length-2).replace(/\.\*\?$/,"*")}function a(l){return l instanceof Error?l.stack||l.message:l}function h(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return r.enable(r.load()),r}Ho.exports=fd});var Oo=f((F,Pr)=>{F.formatArgs=_d;F.save=gd;F.load=md;F.useColors=pd;F.storage=vd();F.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})();F.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function pd(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function _d(e){if(e[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+e[0]+(this.useColors?"%c ":" ")+"+"+Pr.exports.humanize(this.diff),!this.useColors)return;let t="color: "+this.color;e.splice(1,0,t,"color: inherit");let r=0,s=0;e[0].replace(/%[a-zA-Z%]/g,i=>{i!=="%%"&&(r++,i==="%c"&&(s=r))}),e.splice(s,0,t)}F.log=console.debug||console.log||(()=>{});function gd(e){try{e?F.storage.setItem("debug",e):F.storage.removeItem("debug")}catch{}}function md(){let e;try{e=F.storage.getItem("debug")}catch{}return!e&&typeof process<"u"&&"env"in process&&(e=process.env.DEBUG),e}function vd(){try{return localStorage}catch{}}Pr.exports=Bs()(F);var{formatters:yd}=Pr.exports;yd.j=function(e){try{return JSON.stringify(e)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}}});var Do=f((qm,Po)=>{"use strict";Po.exports=(e,t=process.argv)=>{let r=e.startsWith("-")?"":e.length===1?"-":"--",s=t.indexOf(r+e),i=t.indexOf("--");return s!==-1&&(i===-1||s<i)}});var Io=f((Mm,Mo)=>{"use strict";var Ed=require("os"),qo=require("tty"),k=Do(),{env:S}=process,ce;k("no-color")||k("no-colors")||k("color=false")||k("color=never")?ce=0:(k("color")||k("colors")||k("color=true")||k("color=always"))&&(ce=1);"FORCE_COLOR"in S&&(S.FORCE_COLOR==="true"?ce=1:S.FORCE_COLOR==="false"?ce=0:ce=S.FORCE_COLOR.length===0?1:Math.min(parseInt(S.FORCE_COLOR,10),3));function Gs(e){return e===0?!1:{level:e,hasBasic:!0,has256:e>=2,has16m:e>=3}}function Vs(e,t){if(ce===0)return 0;if(k("color=16m")||k("color=full")||k("color=truecolor"))return 3;if(k("color=256"))return 2;if(e&&!t&&ce===void 0)return 0;let r=ce||0;if(S.TERM==="dumb")return r;if(process.platform==="win32"){let s=Ed.release().split(".");return Number(s[0])>=10&&Number(s[2])>=10586?Number(s[2])>=14931?3:2:1}if("CI"in S)return["TRAVIS","CIRCLECI","APPVEYOR","GITLAB_CI","GITHUB_ACTIONS","BUILDKITE"].some(s=>s in S)||S.CI_NAME==="codeship"?1:r;if("TEAMCITY_VERSION"in S)return/^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.test(S.TEAMCITY_VERSION)?1:0;if(S.COLORTERM==="truecolor")return 3;if("TERM_PROGRAM"in S){let s=parseInt((S.TERM_PROGRAM_VERSION||"").split(".")[0],10);switch(S.TERM_PROGRAM){case"iTerm.app":return s>=3?3:2;case"Apple_Terminal":return 2}}return/-256(color)?$/i.test(S.TERM)?2:/^screen|^xterm|^vt100|^vt220|^rxvt|color|ansi|cygwin|linux/i.test(S.TERM)||"COLORTERM"in S?1:r}function Rd(e){let t=Vs(e,e&&e.isTTY);return Gs(t)}Mo.exports={supportsColor:Rd,stdout:Gs(Vs(!0,qo.isatty(1))),stderr:Gs(Vs(!0,qo.isatty(2)))}});var Lo=f((D,qr)=>{var Cd=require("tty"),Dr=require("util");D.init=Hd;D.log=Td;D.formatArgs=Ad;D.save=Sd;D.load=xd;D.useColors=bd;D.destroy=Dr.deprecate(()=>{},"Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.");D.colors=[6,2,3,4,5,1];try{let e=Io();e&&(e.stderr||e).level>=2&&(D.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch{}D.inspectOpts=Object.keys(process.env).filter(e=>/^debug_/i.test(e)).reduce((e,t)=>{let r=t.substring(6).toLowerCase().replace(/_([a-z])/g,(i,n)=>n.toUpperCase()),s=process.env[t];return/^(yes|on|true|enabled)$/i.test(s)?s=!0:/^(no|off|false|disabled)$/i.test(s)?s=!1:s==="null"?s=null:s=Number(s),e[r]=s,e},{});function bd(){return"colors"in D.inspectOpts?Boolean(D.inspectOpts.colors):Cd.isatty(process.stderr.fd)}function Ad(e){let{namespace:t,useColors:r}=this;if(r){let s=this.color,i="\x1B[3"+(s<8?s:"8;5;"+s),n=`  ${i};1m${t} \x1B[0m`;e[0]=n+e[0].split(`
`).join(`
`+n),e.push(i+"m+"+qr.exports.humanize(this.diff)+"\x1B[0m")}else e[0]=wd()+t+" "+e[0]}function wd(){return D.inspectOpts.hideDate?"":new Date().toISOString()+" "}function Td(...e){return process.stderr.write(Dr.format(...e)+`
`)}function Sd(e){e?process.env.DEBUG=e:delete process.env.DEBUG}function xd(){return process.env.DEBUG}function Hd(e){e.inspectOpts={};let t=Object.keys(D.inspectOpts);for(let r=0;r<t.length;r++)e.inspectOpts[t[r]]=D.inspectOpts[t[r]]}qr.exports=Bs()(D);var{formatters:No}=qr.exports;No.o=function(e){return this.inspectOpts.colors=this.useColors,Dr.inspect(e,this.inspectOpts).split(`
`).map(t=>t.trim()).join(" ")};No.O=function(e){return this.inspectOpts.colors=this.useColors,Dr.inspect(e,this.inspectOpts)}});var jo=f((Im,Ws)=>{typeof process>"u"||process.type==="renderer"||process.browser===!0||process.__nwjs?Ws.exports=Oo():Ws.exports=Lo()});var Fo=f((Nm,$o)=>{var bt;$o.exports=function(){if(!bt){try{bt=jo()("follow-redirects")}catch{}typeof bt!="function"&&(bt=function(){})}bt.apply(null,arguments)}});var Ko=f((Lm,Qs)=>{var Re=require("url"),Ys=Re.URL,Od=require("http"),Pd=require("https"),Bo=require("stream").Writable,Go=require("assert"),Vo=Fo(),zs=["abort","aborted","connect","error","socket","timeout"],Js=Object.create(null);zs.forEach(function(e){Js[e]=function(t,r,s){this._redirectable.emit(e,t,r,s)}});var Dd=wt("ERR_INVALID_URL","Invalid URL",TypeError),Uo=wt("ERR_FR_REDIRECTION_FAILURE","Redirected request failed"),qd=wt("ERR_FR_TOO_MANY_REDIRECTS","Maximum number of redirects exceeded"),Md=wt("ERR_FR_MAX_BODY_LENGTH_EXCEEDED","Request body larger than maxBodyLength limit"),Id=wt("ERR_STREAM_WRITE_AFTER_END","write after end");function U(e,t){Bo.call(this),this._sanitizeOptions(e),this._options=e,this._ended=!1,this._ending=!1,this._redirectCount=0,this._redirects=[],this._requestBodyLength=0,this._requestBodyBuffers=[],t&&this.on("response",t);var r=this;this._onNativeResponse=function(s){r._processResponse(s)},this._performRequest()}U.prototype=Object.create(Bo.prototype);U.prototype.abort=function(){Yo(this._currentRequest),this.emit("abort")};U.prototype.write=function(e,t,r){if(this._ending)throw new Id;if(!Ce(e)&&!jd(e))throw new TypeError("data should be a string, Buffer or Uint8Array");if(At(t)&&(r=t,t=null),e.length===0){r&&r();return}this._requestBodyLength+e.length<=this._options.maxBodyLength?(this._requestBodyLength+=e.length,this._requestBodyBuffers.push({data:e,encoding:t}),this._currentRequest.write(e,t,r)):(this.emit("error",new Md),this.abort())};U.prototype.end=function(e,t,r){if(At(e)?(r=e,e=t=null):At(t)&&(r=t,t=null),!e)this._ended=this._ending=!0,this._currentRequest.end(null,null,r);else{var s=this,i=this._currentRequest;this.write(e,t,function(){s._ended=!0,i.end(null,null,r)}),this._ending=!0}};U.prototype.setHeader=function(e,t){this._options.headers[e]=t,this._currentRequest.setHeader(e,t)};U.prototype.removeHeader=function(e){delete this._options.headers[e],this._currentRequest.removeHeader(e)};U.prototype.setTimeout=function(e,t){var r=this;function s(o){o.setTimeout(e),o.removeListener("timeout",o.destroy),o.addListener("timeout",o.destroy)}function i(o){r._timeout&&clearTimeout(r._timeout),r._timeout=setTimeout(function(){r.emit("timeout"),n()},e),s(o)}function n(){r._timeout&&(clearTimeout(r._timeout),r._timeout=null),r.removeListener("abort",n),r.removeListener("error",n),r.removeListener("response",n),t&&r.removeListener("timeout",t),r.socket||r._currentRequest.removeListener("socket",i)}return t&&this.on("timeout",t),this.socket?i(this.socket):this._currentRequest.once("socket",i),this.on("socket",s),this.on("abort",n),this.on("error",n),this.on("response",n),this};["flushHeaders","getHeader","setNoDelay","setSocketKeepAlive"].forEach(function(e){U.prototype[e]=function(t,r){return this._currentRequest[e](t,r)}});["aborted","connection","socket"].forEach(function(e){Object.defineProperty(U.prototype,e,{get:function(){return this._currentRequest[e]}})});U.prototype._sanitizeOptions=function(e){if(e.headers||(e.headers={}),e.host&&(e.hostname||(e.hostname=e.host),delete e.host),!e.pathname&&e.path){var t=e.path.indexOf("?");t<0?e.pathname=e.path:(e.pathname=e.path.substring(0,t),e.search=e.path.substring(t))}};U.prototype._performRequest=function(){var e=this._options.protocol,t=this._options.nativeProtocols[e];if(!t){this.emit("error",new TypeError("Unsupported protocol "+e));return}if(this._options.agents){var r=e.slice(0,-1);this._options.agent=this._options.agents[r]}var s=this._currentRequest=t.request(this._options,this._onNativeResponse);s._redirectable=this;for(var i of zs)s.on(i,Js[i]);if(this._currentUrl=/^\//.test(this._options.path)?Re.format(this._options):this._options.path,this._isRedirect){var n=0,o=this,u=this._requestBodyBuffers;(function a(h){if(s===o._currentRequest)if(h)o.emit("error",h);else if(n<u.length){var l=u[n++];s.finished||s.write(l.data,l.encoding,a)}else o._ended&&s.end()})()}};U.prototype._processResponse=function(e){var t=e.statusCode;this._options.trackRedirects&&this._redirects.push({url:this._currentUrl,headers:e.headers,statusCode:t});var r=e.headers.location;if(!r||this._options.followRedirects===!1||t<300||t>=400){e.responseUrl=this._currentUrl,e.redirects=this._redirects,this.emit("response",e),this._requestBodyBuffers=[];return}if(Yo(this._currentRequest),e.destroy(),++this._redirectCount>this._options.maxRedirects){this.emit("error",new qd);return}var s,i=this._options.beforeRedirect;i&&(s=Object.assign({Host:e.req.getHeader("host")},this._options.headers));var n=this._options.method;((t===301||t===302)&&this._options.method==="POST"||t===303&&!/^(?:GET|HEAD)$/.test(this._options.method))&&(this._options.method="GET",this._requestBodyBuffers=[],Ks(/^content-/i,this._options.headers));var o=Ks(/^host$/i,this._options.headers),u=Re.parse(this._currentUrl),a=o||u.host,h=/^\w+:/.test(r)?this._currentUrl:Re.format(Object.assign(u,{host:a})),l;try{l=Re.resolve(h,r)}catch(_){this.emit("error",new Uo({cause:_}));return}Vo("redirecting to",l),this._isRedirect=!0;var c=Re.parse(l);if(Object.assign(this._options,c),(c.protocol!==u.protocol&&c.protocol!=="https:"||c.host!==a&&!Ld(c.host,a))&&Ks(/^(?:authorization|cookie)$/i,this._options.headers),At(i)){var d={headers:e.headers,statusCode:t},p={url:h,method:n,headers:s};try{i(this._options,d,p)}catch(_){this.emit("error",_);return}this._sanitizeOptions(this._options)}try{this._performRequest()}catch(_){this.emit("error",new Uo({cause:_}))}};function Wo(e){var t={maxRedirects:21,maxBodyLength:10485760},r={};return Object.keys(e).forEach(function(s){var i=s+":",n=r[i]=e[s],o=t[s]=Object.create(n);function u(h,l,c){if(Ce(h)){var d;try{d=ko(new Ys(h))}catch{d=Re.parse(h)}if(!Ce(d.protocol))throw new Dd({input:h});h=d}else Ys&&h instanceof Ys?h=ko(h):(c=l,l=h,h={protocol:i});return At(l)&&(c=l,l=null),l=Object.assign({maxRedirects:t.maxRedirects,maxBodyLength:t.maxBodyLength},h,l),l.nativeProtocols=r,!Ce(l.host)&&!Ce(l.hostname)&&(l.hostname="::1"),Go.equal(l.protocol,i,"protocol mismatch"),Vo("options",l),new U(l,c)}function a(h,l,c){var d=o.request(h,l,c);return d.end(),d}Object.defineProperties(o,{request:{value:u,configurable:!0,enumerable:!0,writable:!0},get:{value:a,configurable:!0,enumerable:!0,writable:!0}})}),t}function Nd(){}function ko(e){var t={protocol:e.protocol,hostname:e.hostname.startsWith("[")?e.hostname.slice(1,-1):e.hostname,hash:e.hash,search:e.search,pathname:e.pathname,path:e.pathname+e.search,href:e.href};return e.port!==""&&(t.port=Number(e.port)),t}function Ks(e,t){var r;for(var s in t)e.test(s)&&(r=t[s],delete t[s]);return r===null||typeof r>"u"?void 0:String(r).trim()}function wt(e,t,r){function s(i){Error.captureStackTrace(this,this.constructor),Object.assign(this,i||{}),this.code=e,this.message=this.cause?t+": "+this.cause.message:t}return s.prototype=new(r||Error),s.prototype.constructor=s,s.prototype.name="Error ["+e+"]",s}function Yo(e){for(var t of zs)e.removeListener(t,Js[t]);e.on("error",Nd),e.abort()}function Ld(e,t){Go(Ce(e)&&Ce(t));var r=e.length-t.length-1;return r>0&&e[r]==="."&&e.endsWith(t)}function Ce(e){return typeof e=="string"||e instanceof String}function At(e){return typeof e=="function"}function jd(e){return typeof e=="object"&&"length"in e}Qs.exports=Wo({http:Od,https:Pd});Qs.exports.wrap=Wo});var Jo=f((jm,zo)=>{var $d=require("http"),Fd=require("https"),Tt=To(),Mr=Hr(),Ud=Ko();Tt=Object.keys(Tt).map(function(e){return Tt[e]});var kd={http:$d,https:Fd};zo.exports={deleteLength:function(t,r,s){(t.method==="DELETE"||t.method==="OPTIONS")&&!t.headers["content-length"]&&(t.headers["content-length"]="0",delete t.headers["transfer-encoding"])},timeout:function(t,r,s){s.timeout&&t.socket.setTimeout(s.timeout)},XHeaders:function(t,r,s){if(!!s.xfwd){var i=t.isSpdy||Mr.hasEncryptedConnection(t),n={for:t.connection.remoteAddress||t.socket.remoteAddress,port:Mr.getPort(t),proto:i?"https":"http"};["for","port","proto"].forEach(function(o){t.headers["x-forwarded-"+o]=(t.headers["x-forwarded-"+o]||"")+(t.headers["x-forwarded-"+o]?",":"")+n[o]}),t.headers["x-forwarded-host"]=t.headers["x-forwarded-host"]||t.headers.host||""}},stream:function(t,r,s,i,n,o){n.emit("start",t,r,s.target||s.forward);var u=s.followRedirects?Ud:kd,a=u.http,h=u.https;if(s.forward){var l=(s.forward.protocol==="https:"?h:a).request(Mr.setupOutgoing(s.ssl||{},s,t,"forward")),c=_(l,s.forward);if(t.on("error",c),l.on("error",c),(s.buffer||t).pipe(l),!s.target)return r.end()}var d=(s.target.protocol==="https:"?h:a).request(Mr.setupOutgoing(s.ssl||{},s,t));d.on("socket",function(g){n&&!d.getHeader("expect")&&n.emit("proxyReq",d,t,r,s)}),s.proxyTimeout&&d.setTimeout(s.proxyTimeout,function(){d.abort()}),t.on("aborted",function(){d.abort()});var p=_(d,s.target);t.on("error",p),d.on("error",p);function _(g,m){return function(N){if(t.socket.destroyed&&N.code==="ECONNRESET")return n.emit("econnreset",N,t,r,m),g.abort();o?o(N,t,r,m):n.emit("error",N,t,r,m)}}(s.buffer||t).pipe(d),d.on("response",function(g){if(n&&n.emit("proxyRes",g,t,r),!r.headersSent&&!s.selfHandleResponse)for(var m=0;m<Tt.length&&!Tt[m](t,r,g,s);m++);r.finished?n&&n.emit("end",t,r,g):(g.on("end",function(){n&&n.emit("end",t,r,g)}),s.selfHandleResponse||g.pipe(r))})}}});var Xo=f(($m,Qo)=>{var Bd=require("http"),Gd=require("https"),We=Hr();Qo.exports={checkMethodAndHeader:function(t,r){if(t.method!=="GET"||!t.headers.upgrade||t.headers.upgrade.toLowerCase()!=="websocket")return r.destroy(),!0},XHeaders:function(t,r,s){if(!!s.xfwd){var i={for:t.connection.remoteAddress||t.socket.remoteAddress,port:We.getPort(t),proto:We.hasEncryptedConnection(t)?"wss":"ws"};["for","port","proto"].forEach(function(n){t.headers["x-forwarded-"+n]=(t.headers["x-forwarded-"+n]||"")+(t.headers["x-forwarded-"+n]?",":"")+i[n]})}},stream:function(t,r,s,i,n,o){var u=function(l,c){return Object.keys(c).reduce(function(d,p){var _=c[p];if(!Array.isArray(_))return d.push(p+": "+_),d;for(var g=0;g<_.length;g++)d.push(p+": "+_[g]);return d},[l]).join(`\r
`)+`\r
\r
`};We.setupSocket(r),i&&i.length&&r.unshift(i);var a=(We.isSSL.test(s.target.protocol)?Gd:Bd).request(We.setupOutgoing(s.ssl||{},s,t));return n&&n.emit("proxyReqWs",a,t,r,s,i),a.on("error",h),a.on("response",function(l){l.upgrade||(r.write(u("HTTP/"+l.httpVersion+" "+l.statusCode+" "+l.statusMessage,l.headers)),l.pipe(r))}),a.on("upgrade",function(l,c,d){c.on("error",h),c.on("end",function(){n.emit("close",l,c,d)}),r.on("error",function(){c.end()}),We.setupSocket(c),d&&d.length&&c.unshift(d),r.write(u("HTTP/1.1 101 Switching Protocols",l.headers)),c.pipe(r).pipe(c),n.emit("open",c),n.emit("proxySocket",c)}),a.end();function h(l){o?o(l,t,r):n.emit("error",l,t,r),r.end()}}}});var ia=f((Fm,na)=>{var ra=na.exports,Zo=require("util")._extend,Vd=require("url").parse,sa=vo(),Wd=require("http"),Yd=require("https"),ea=Jo(),ta=Xo();ra.Server=be;function Xs(e){return function(t){return function(r,s){var i=e==="ws"?this.wsPasses:this.webPasses,n=[].slice.call(arguments),o=n.length-1,u,a;typeof n[o]=="function"&&(a=n[o],o--);var h=t;if(!(n[o]instanceof Buffer)&&n[o]!==s&&(h=Zo({},t),Zo(h,n[o]),o--),n[o]instanceof Buffer&&(u=n[o]),["target","forward"].forEach(function(c){typeof h[c]=="string"&&(h[c]=Vd(h[c]))}),!h.target&&!h.forward)return this.emit("error",new Error("Must provide a proper URL as target"));for(var l=0;l<i.length&&!i[l](r,s,h,u,this,a);l++);}}}ra.createRightProxy=Xs;function be(e){sa.call(this),e=e||{},e.prependPath=e.prependPath!==!1,this.web=this.proxyRequest=Xs("web")(e),this.ws=this.proxyWebsocketRequest=Xs("ws")(e),this.options=e,this.webPasses=Object.keys(ea).map(function(t){return ea[t]}),this.wsPasses=Object.keys(ta).map(function(t){return ta[t]}),this.on("error",this.onError,this)}require("util").inherits(be,sa);be.prototype.onError=function(e){if(this.listeners("error").length===1)throw e};be.prototype.listen=function(e,t){var r=this,s=function(i,n){r.web(i,n)};return this._server=this.options.ssl?Yd.createServer(this.options.ssl,s):Wd.createServer(s),this.options.ws&&this._server.on("upgrade",function(i,n,o){r.ws(i,n,o)}),this._server.listen(e,t),this};be.prototype.close=function(e){var t=this;this._server&&this._server.close(r);function r(){t._server=null,e&&e.apply(null,arguments)}};be.prototype.before=function(e,t,r){if(e!=="ws"&&e!=="web")throw new Error("type must be `web` or `ws`");var s=e==="ws"?this.wsPasses:this.webPasses,i=!1;if(s.forEach(function(n,o){n.name===t&&(i=o)}),i===!1)throw new Error("No such pass");s.splice(i,0,r)};be.prototype.after=function(e,t,r){if(e!=="ws"&&e!=="web")throw new Error("type must be `web` or `ws`");var s=e==="ws"?this.wsPasses:this.webPasses,i=!1;if(s.forEach(function(n,o){n.name===t&&(i=o)}),i===!1)throw new Error("No such pass");s.splice(i++,0,r)}});var aa=f((Um,oa)=>{var St=ia().Server;function Zs(e){return new St(e)}St.createProxyServer=Zs;St.createServer=Zs;St.createProxy=Zs;oa.exports=St});var ca=f((km,ua)=>{ua.exports=aa()});var la=f(xt=>{"use strict";var Kd=xt&&xt.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(xt,"__esModule",{value:!0});var zd=Kd(ca()),Jd=zd.default.createProxyServer({changeOrigin:!0});function Qd(e,t,r,s){let n={target:{protocol:r.domainOrIp==="127.0.0.1"?"http":"https",host:r.domainOrIp,port:r.port}};Jd.web(e,t,n,s||Function.prototype)}xt.default=Qd});var en=f(X=>{"use strict";Object.defineProperty(X,"__esModule",{value:!0});var Xd=[/^\s*x-0-platform\s*/i,/^\s*x-0-version\s*$/i,/^\s*x-0-t\s*$/i,/^\s*x-0-components\s*$/i,/^\s*x-0-status\s*$/i,/^\s*x-0-lambda-name\s*$/i,/^\s*x-0-lambda-schedule-timeout\s*$/i,/^\s*x-0-received-at\s*$/i,/^\s*host\s*$/i,/^\s*x-request-id\s*$/i,/^\s*content-length\s*$/i,/^\s*via\s*$/i],Zd=[/^layer0_/i],ef=[/^layer0_devtools/i],Ye=e=>{if(Xd.find(t=>e.match(t)))throw new Error(`Header "${e}" is reserved and cannot be modified`)},tf=e=>{if(Zd.find(t=>e.match(t))&&!ef.find(t=>e.match(t)))throw new Error(`Cookie "${e}" is reserved and cannot be modified`)};X.validateSetResponseHeader=e=>{Ye(e)};X.validateUpdateResponseHeader=e=>{Ye(e)};X.validateRemoveResponseHeader=e=>{Ye(e)};X.validateSetRequestHeader=e=>{Ye(e)};X.validateUpdateRequestHeader=e=>{Ye(e)};X.validateRemoveRequestHeader=e=>{Ye(e)};X.validateCookieName=e=>{tf(e)}});var rn=f(tn=>{"use strict";Object.defineProperty(tn,"__esModule",{value:!0});function rf(e){return e==null?{}:typeof e=="string"?{path:e}:e}tn.default=rf});var sn=f(Ir=>{"use strict";Object.defineProperty(Ir,"__esModule",{value:!0});var sf=br(),Ht=class extends Error{constructor(t){super(`Route pattern "${t}" contains invalid syntax. See https://docs.layer0.co/guides/routing#section_route_pattern_syntax`),this.isUserError=!0}};Ir.PathMatcherError=Ht;var Ke=class{constructor(t){this.pattern=t}match(t){if(!this.matcher)try{this.matcher=sf.match(this.pattern,{decode:decodeURIComponent})}catch{throw new Ht(this.pattern)}Ke.validatePattern(this.pattern);let r=this.matcher(t);return r?r.params:void 0}static validatePattern(t){let r=t.match(this.PARTIAL_SPLAT_ROUTE);if(r){let[s,i,n]=r,o=t.replace(`${i}${n}`,`${i}:suffix/${n}`);throw new Ht(`Partial splat routes are not supported. Use "${o}" instead of "${t}"`)}return!0}};Ir.default=Ke;Ke.PARTIAL_SPLAT_ROUTE=/(\/[^:/]+)(:[^*/#?]+\*)/});var ha=f(nn=>{"use strict";Object.defineProperty(nn,"__esModule",{value:!0});function nf(e){return typeof e!="string"?"":e.toLowerCase()}nn.default=nf});var Lr=f(we=>{"use strict";var Nr=we&&we.__importDefault||function(e){return e&&e.__esModule?e:{default:e}},of=we&&we.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(we,"__esModule",{value:!0});var af=T(),Ot=ct(),uf=Sr(),cf=br(),lf=Nr(rn()),da=of(sn()),hf=Nr(require("querystring")),df=Nr(Cr()),ff=Nr(ha()),Ae=class{constructor(t,r,s){this.criteria=lf.default(t),this.handler=r,this.options=s,this.criteria.path&&(this.matcher=new da.default(this.criteria.path))}match(t){let r=[this.matchPath,this.matchProtocol,this.matchMethod,this.matchHeaders,this.matchQueryParams,this.matchCookies,this.matchBody],s={};for(let i of r){let n=i.bind(this)(t);if(!n)return!1;Object.assign(s,n)}return t.params=s,s}matchResponse(t){return this.matchResponseStatus(t)}matchResponseStatus(t){var r,s,i;return!((s=(r=this.criteria)===null||r===void 0?void 0:r.response)===null||s===void 0)&&s.statusCode?!!(!((i=t.statusCode)===null||i===void 0)&&i.toString().match(this.criteria.response.statusCode)):!1}matchPath(t){return this.matcher?this.matcher.match(t.path):{}}matchMethod(t){return!this.criteria.method||!t.method?!0:new RegExp(this.criteria.method,"i").test(t.method)}matchHeaders(t){return this.criteria.headers?Ot.matchCriteriaRegexObjectWithRequestObject(this.criteria.headers,t.headers,ff.default):!0}matchBody(t){if(this.criteria.body&&this.criteria.body.parse=="json"&&t.body){let r;try{r=JSON.parse(t.body)}catch{return!1}return Ot.deepMatchObject(r,this.criteria.body.criteria)}return!0}matchQueryParams(t){return this.criteria.query?t.query?Ot.matchCriteriaRegexObjectWithRequestObject(this.criteria.query,t.query):!1:!0}matchCookies(t){if(this.criteria.cookies){let r=t.headers.cookie;if(r==null)return Object.values(this.criteria.cookies).every(n=>n===null);let s=Array.isArray(r)?r.join("; "):r,i=uf.parse(s);return Ot.matchCriteriaRegexObjectWithRequestObject(this.criteria.cookies,i)}return!0}matchProtocol(t){let r=t.headers&&t.headers[af.HTTP_HEADERS.x0Protocol]||"https",s;return typeof this.criteria.protocol=="string"?s=new RegExp(`^${this.criteria.protocol}$`,"i"):s=new RegExp(this.criteria.protocol||"^https$","i"),Ot.testRegExp(s,r)}toString(){let{path:t,...r}=this.criteria;return Object.keys(r).length?JSON.stringify(this.criteria):t||"fallback"}toRegex(){return Ae.toRegexp(this.criteria.path)}toJson(){var t;return JSON.stringify({...this.criteria,label:(t=this.options)===null||t===void 0?void 0:t.label},(r,s)=>s instanceof RegExp?s.toString():s)}toRegexString(){return this.toRegex().source}toEdgeRegexString(){return Ae.toEdgeRegexString(this.criteria.path)}isRespRoute(){return!!this.criteria.response}static toRegexp(t){if(t)try{return cf.pathToRegexp(t)}catch{throw new da.PathMatcherError(t)}else return/^.*$/}static toEdgeRegexString(t){return df.default(Ae.toRegexp(t))}static pathWithQueryString(t,r){let s=hf.default.stringify(r).replace(/%3A/g,":");return t+(s&&`\\?${s}`)}};we.default=Ae});var pa=f(on=>{"use strict";Object.defineProperty(on,"__esModule",{value:!0});var fa=require("zlib"),Te=T();function pf(e){var t;let r=(t=e.getHeader(Te.HTTP_HEADERS.contentEncoding))===null||t===void 0?void 0:t.toLowerCase();if(!r)return!0;switch(r){case Te.GZIP_ENCODING:return Buffer.isBuffer(e.body)?(e.body=fa.gunzipSync(e.body),e.removeHeader(Te.HTTP_HEADERS.contentEncoding),e.setHeader(Te.HTTP_HEADERS.contentLength,Buffer.byteLength(e.body)),!0):!1;case Te.BROTLI_ENCODING:return Buffer.isBuffer(e.body)?(e.body=fa.brotliDecompressSync(e.body),e.removeHeader(Te.HTTP_HEADERS.contentEncoding),e.setHeader(Te.HTTP_HEADERS.contentLength,Buffer.byteLength(e.body)),!0):!1;default:return!1}}on.default=pf});var ga=f((Jm,_a)=>{"use strict";_a.exports=function(e){e.prototype[Symbol.iterator]=function*(){for(let t=this.head;t;t=t.next)yield t.value}}});var va=f((Qm,ma)=>{"use strict";ma.exports=R;R.Node=Se;R.create=R;function R(e){var t=this;if(t instanceof R||(t=new R),t.tail=null,t.head=null,t.length=0,e&&typeof e.forEach=="function")e.forEach(function(i){t.push(i)});else if(arguments.length>0)for(var r=0,s=arguments.length;r<s;r++)t.push(arguments[r]);return t}R.prototype.removeNode=function(e){if(e.list!==this)throw new Error("removing node which does not belong to this list");var t=e.next,r=e.prev;return t&&(t.prev=r),r&&(r.next=t),e===this.head&&(this.head=t),e===this.tail&&(this.tail=r),e.list.length--,e.next=null,e.prev=null,e.list=null,t};R.prototype.unshiftNode=function(e){if(e!==this.head){e.list&&e.list.removeNode(e);var t=this.head;e.list=this,e.next=t,t&&(t.prev=e),this.head=e,this.tail||(this.tail=e),this.length++}};R.prototype.pushNode=function(e){if(e!==this.tail){e.list&&e.list.removeNode(e);var t=this.tail;e.list=this,e.prev=t,t&&(t.next=e),this.tail=e,this.head||(this.head=e),this.length++}};R.prototype.push=function(){for(var e=0,t=arguments.length;e<t;e++)gf(this,arguments[e]);return this.length};R.prototype.unshift=function(){for(var e=0,t=arguments.length;e<t;e++)mf(this,arguments[e]);return this.length};R.prototype.pop=function(){if(!!this.tail){var e=this.tail.value;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,e}};R.prototype.shift=function(){if(!!this.head){var e=this.head.value;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,e}};R.prototype.forEach=function(e,t){t=t||this;for(var r=this.head,s=0;r!==null;s++)e.call(t,r.value,s,this),r=r.next};R.prototype.forEachReverse=function(e,t){t=t||this;for(var r=this.tail,s=this.length-1;r!==null;s--)e.call(t,r.value,s,this),r=r.prev};R.prototype.get=function(e){for(var t=0,r=this.head;r!==null&&t<e;t++)r=r.next;if(t===e&&r!==null)return r.value};R.prototype.getReverse=function(e){for(var t=0,r=this.tail;r!==null&&t<e;t++)r=r.prev;if(t===e&&r!==null)return r.value};R.prototype.map=function(e,t){t=t||this;for(var r=new R,s=this.head;s!==null;)r.push(e.call(t,s.value,this)),s=s.next;return r};R.prototype.mapReverse=function(e,t){t=t||this;for(var r=new R,s=this.tail;s!==null;)r.push(e.call(t,s.value,this)),s=s.prev;return r};R.prototype.reduce=function(e,t){var r,s=this.head;if(arguments.length>1)r=t;else if(this.head)s=this.head.next,r=this.head.value;else throw new TypeError("Reduce of empty list with no initial value");for(var i=0;s!==null;i++)r=e(r,s.value,i),s=s.next;return r};R.prototype.reduceReverse=function(e,t){var r,s=this.tail;if(arguments.length>1)r=t;else if(this.tail)s=this.tail.prev,r=this.tail.value;else throw new TypeError("Reduce of empty list with no initial value");for(var i=this.length-1;s!==null;i--)r=e(r,s.value,i),s=s.prev;return r};R.prototype.toArray=function(){for(var e=new Array(this.length),t=0,r=this.head;r!==null;t++)e[t]=r.value,r=r.next;return e};R.prototype.toArrayReverse=function(){for(var e=new Array(this.length),t=0,r=this.tail;r!==null;t++)e[t]=r.value,r=r.prev;return e};R.prototype.slice=function(e,t){t=t||this.length,t<0&&(t+=this.length),e=e||0,e<0&&(e+=this.length);var r=new R;if(t<e||t<0)return r;e<0&&(e=0),t>this.length&&(t=this.length);for(var s=0,i=this.head;i!==null&&s<e;s++)i=i.next;for(;i!==null&&s<t;s++,i=i.next)r.push(i.value);return r};R.prototype.sliceReverse=function(e,t){t=t||this.length,t<0&&(t+=this.length),e=e||0,e<0&&(e+=this.length);var r=new R;if(t<e||t<0)return r;e<0&&(e=0),t>this.length&&(t=this.length);for(var s=this.length,i=this.tail;i!==null&&s>t;s--)i=i.prev;for(;i!==null&&s>e;s--,i=i.prev)r.push(i.value);return r};R.prototype.splice=function(e,t,...r){e>this.length&&(e=this.length-1),e<0&&(e=this.length+e);for(var s=0,i=this.head;i!==null&&s<e;s++)i=i.next;for(var n=[],s=0;i&&s<t;s++)n.push(i.value),i=this.removeNode(i);i===null&&(i=this.tail),i!==this.head&&i!==this.tail&&(i=i.prev);for(var s=0;s<r.length;s++)i=_f(this,i,r[s]);return n};R.prototype.reverse=function(){for(var e=this.head,t=this.tail,r=e;r!==null;r=r.prev){var s=r.prev;r.prev=r.next,r.next=s}return this.head=t,this.tail=e,this};function _f(e,t,r){var s=t===e.head?new Se(r,null,t,e):new Se(r,t,t.next,e);return s.next===null&&(e.tail=s),s.prev===null&&(e.head=s),e.length++,s}function gf(e,t){e.tail=new Se(t,e.tail,null,e),e.head||(e.head=e.tail),e.length++}function mf(e,t){e.head=new Se(t,null,e.head,e),e.tail||(e.tail=e.head),e.length++}function Se(e,t,r,s){if(!(this instanceof Se))return new Se(e,t,r,s);this.list=s,this.value=e,t?(t.next=this,this.prev=t):this.prev=null,r?(r.prev=this,this.next=r):this.next=null}try{ga()(R)}catch{}});var ba=f((Xm,Ca)=>{"use strict";var vf=va(),xe=Symbol("max"),ee=Symbol("length"),ze=Symbol("lengthCalculator"),Dt=Symbol("allowStale"),He=Symbol("maxAge"),Z=Symbol("dispose"),ya=Symbol("noDisposeOnSet"),x=Symbol("lruList"),W=Symbol("cache"),Ra=Symbol("updateAgeOnGet"),an=()=>1,cn=class{constructor(t){if(typeof t=="number"&&(t={max:t}),t||(t={}),t.max&&(typeof t.max!="number"||t.max<0))throw new TypeError("max must be a non-negative number");let r=this[xe]=t.max||1/0,s=t.length||an;if(this[ze]=typeof s!="function"?an:s,this[Dt]=t.stale||!1,t.maxAge&&typeof t.maxAge!="number")throw new TypeError("maxAge must be a number");this[He]=t.maxAge||0,this[Z]=t.dispose,this[ya]=t.noDisposeOnSet||!1,this[Ra]=t.updateAgeOnGet||!1,this.reset()}set max(t){if(typeof t!="number"||t<0)throw new TypeError("max must be a non-negative number");this[xe]=t||1/0,Pt(this)}get max(){return this[xe]}set allowStale(t){this[Dt]=!!t}get allowStale(){return this[Dt]}set maxAge(t){if(typeof t!="number")throw new TypeError("maxAge must be a non-negative number");this[He]=t,Pt(this)}get maxAge(){return this[He]}set lengthCalculator(t){typeof t!="function"&&(t=an),t!==this[ze]&&(this[ze]=t,this[ee]=0,this[x].forEach(r=>{r.length=this[ze](r.value,r.key),this[ee]+=r.length})),Pt(this)}get lengthCalculator(){return this[ze]}get length(){return this[ee]}get itemCount(){return this[x].length}rforEach(t,r){r=r||this;for(let s=this[x].tail;s!==null;){let i=s.prev;Ea(this,t,s,r),s=i}}forEach(t,r){r=r||this;for(let s=this[x].head;s!==null;){let i=s.next;Ea(this,t,s,r),s=i}}keys(){return this[x].toArray().map(t=>t.key)}values(){return this[x].toArray().map(t=>t.value)}reset(){this[Z]&&this[x]&&this[x].length&&this[x].forEach(t=>this[Z](t.key,t.value)),this[W]=new Map,this[x]=new vf,this[ee]=0}dump(){return this[x].map(t=>jr(this,t)?!1:{k:t.key,v:t.value,e:t.now+(t.maxAge||0)}).toArray().filter(t=>t)}dumpLru(){return this[x]}set(t,r,s){if(s=s||this[He],s&&typeof s!="number")throw new TypeError("maxAge must be a number");let i=s?Date.now():0,n=this[ze](r,t);if(this[W].has(t)){if(n>this[xe])return Je(this,this[W].get(t)),!1;let a=this[W].get(t).value;return this[Z]&&(this[ya]||this[Z](t,a.value)),a.now=i,a.maxAge=s,a.value=r,this[ee]+=n-a.length,a.length=n,this.get(t),Pt(this),!0}let o=new ln(t,r,n,i,s);return o.length>this[xe]?(this[Z]&&this[Z](t,r),!1):(this[ee]+=o.length,this[x].unshift(o),this[W].set(t,this[x].head),Pt(this),!0)}has(t){if(!this[W].has(t))return!1;let r=this[W].get(t).value;return!jr(this,r)}get(t){return un(this,t,!0)}peek(t){return un(this,t,!1)}pop(){let t=this[x].tail;return t?(Je(this,t),t.value):null}del(t){Je(this,this[W].get(t))}load(t){this.reset();let r=Date.now();for(let s=t.length-1;s>=0;s--){let i=t[s],n=i.e||0;if(n===0)this.set(i.k,i.v);else{let o=n-r;o>0&&this.set(i.k,i.v,o)}}}prune(){this[W].forEach((t,r)=>un(this,r,!1))}},un=(e,t,r)=>{let s=e[W].get(t);if(s){let i=s.value;if(jr(e,i)){if(Je(e,s),!e[Dt])return}else r&&(e[Ra]&&(s.value.now=Date.now()),e[x].unshiftNode(s));return i.value}},jr=(e,t)=>{if(!t||!t.maxAge&&!e[He])return!1;let r=Date.now()-t.now;return t.maxAge?r>t.maxAge:e[He]&&r>e[He]},Pt=e=>{if(e[ee]>e[xe])for(let t=e[x].tail;e[ee]>e[xe]&&t!==null;){let r=t.prev;Je(e,t),t=r}},Je=(e,t)=>{if(t){let r=t.value;e[Z]&&e[Z](r.key,r.value),e[ee]-=r.length,e[W].delete(r.key),e[x].removeNode(t)}},ln=class{constructor(t,r,s,i,n){this.key=t,this.value=r,this.length=s,this.now=i,this.maxAge=n||0}},Ea=(e,t,r,s)=>{let i=r.value;jr(e,i)&&(Je(e,r),e[Dt]||(i=void 0)),i&&t.call(s,i.value,i.key,e)};Ca.exports=cn});var wn=f((qt,Qe)=>{var yf=200,Ia="__lodash_hash_undefined__",Na=9007199254740991,vn="[object Arguments]",Ef="[object Array]",La="[object Boolean]",ja="[object Date]",Rf="[object Error]",yn="[object Function]",$a="[object GeneratorFunction]",$r="[object Map]",Fa="[object Number]",En="[object Object]",Aa="[object Promise]",Ua="[object RegExp]",Fr="[object Set]",ka="[object String]",Ba="[object Symbol]",dn="[object WeakMap]",Ga="[object ArrayBuffer]",Ur="[object DataView]",Va="[object Float32Array]",Wa="[object Float64Array]",Ya="[object Int8Array]",Ka="[object Int16Array]",za="[object Int32Array]",Ja="[object Uint8Array]",Qa="[object Uint8ClampedArray]",Xa="[object Uint16Array]",Za="[object Uint32Array]",Cf=/[\\^$.*+?()[\]{}|]/g,bf=/\w*$/,Af=/^\[object .+?Constructor\]$/,wf=/^(?:0|[1-9]\d*)$/,A={};A[vn]=A[Ef]=A[Ga]=A[Ur]=A[La]=A[ja]=A[Va]=A[Wa]=A[Ya]=A[Ka]=A[za]=A[$r]=A[Fa]=A[En]=A[Ua]=A[Fr]=A[ka]=A[Ba]=A[Ja]=A[Qa]=A[Xa]=A[Za]=!0;A[Rf]=A[yn]=A[dn]=!1;var Tf=typeof global=="object"&&global&&global.Object===Object&&global,Sf=typeof self=="object"&&self&&self.Object===Object&&self,te=Tf||Sf||Function("return this")(),eu=typeof qt=="object"&&qt&&!qt.nodeType&&qt,wa=eu&&typeof Qe=="object"&&Qe&&!Qe.nodeType&&Qe,xf=wa&&wa.exports===eu;function Hf(e,t){return e.set(t[0],t[1]),e}function Of(e,t){return e.add(t),e}function Pf(e,t){for(var r=-1,s=e?e.length:0;++r<s&&t(e[r],r,e)!==!1;);return e}function Df(e,t){for(var r=-1,s=t.length,i=e.length;++r<s;)e[i+r]=t[r];return e}function tu(e,t,r,s){var i=-1,n=e?e.length:0;for(s&&n&&(r=e[++i]);++i<n;)r=t(r,e[i],i,e);return r}function qf(e,t){for(var r=-1,s=Array(e);++r<e;)s[r]=t(r);return s}function Mf(e,t){return e==null?void 0:e[t]}function ru(e){var t=!1;if(e!=null&&typeof e.toString!="function")try{t=!!(e+"")}catch{}return t}function Ta(e){var t=-1,r=Array(e.size);return e.forEach(function(s,i){r[++t]=[i,s]}),r}function Rn(e,t){return function(r){return e(t(r))}}function Sa(e){var t=-1,r=Array(e.size);return e.forEach(function(s){r[++t]=s}),r}var If=Array.prototype,Nf=Function.prototype,kr=Object.prototype,hn=te["__core-js_shared__"],xa=function(){var e=/[^.]+$/.exec(hn&&hn.keys&&hn.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),su=Nf.toString,le=kr.hasOwnProperty,Br=kr.toString,Lf=RegExp("^"+su.call(le).replace(Cf,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Ha=xf?te.Buffer:void 0,Oa=te.Symbol,Pa=te.Uint8Array,jf=Rn(Object.getPrototypeOf,Object),$f=Object.create,Ff=kr.propertyIsEnumerable,Uf=If.splice,Da=Object.getOwnPropertySymbols,kf=Ha?Ha.isBuffer:void 0,Bf=Rn(Object.keys,Object),fn=et(te,"DataView"),Mt=et(te,"Map"),pn=et(te,"Promise"),_n=et(te,"Set"),gn=et(te,"WeakMap"),It=et(Object,"create"),Gf=De(fn),Vf=De(Mt),Wf=De(pn),Yf=De(_n),Kf=De(gn),qa=Oa?Oa.prototype:void 0,Ma=qa?qa.valueOf:void 0;function Pe(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var s=e[t];this.set(s[0],s[1])}}function zf(){this.__data__=It?It(null):{}}function Jf(e){return this.has(e)&&delete this.__data__[e]}function Qf(e){var t=this.__data__;if(It){var r=t[e];return r===Ia?void 0:r}return le.call(t,e)?t[e]:void 0}function Xf(e){var t=this.__data__;return It?t[e]!==void 0:le.call(t,e)}function Zf(e,t){var r=this.__data__;return r[e]=It&&t===void 0?Ia:t,this}Pe.prototype.clear=zf;Pe.prototype.delete=Jf;Pe.prototype.get=Qf;Pe.prototype.has=Xf;Pe.prototype.set=Zf;function re(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var s=e[t];this.set(s[0],s[1])}}function ep(){this.__data__=[]}function tp(e){var t=this.__data__,r=Gr(t,e);if(r<0)return!1;var s=t.length-1;return r==s?t.pop():Uf.call(t,r,1),!0}function rp(e){var t=this.__data__,r=Gr(t,e);return r<0?void 0:t[r][1]}function sp(e){return Gr(this.__data__,e)>-1}function np(e,t){var r=this.__data__,s=Gr(r,e);return s<0?r.push([e,t]):r[s][1]=t,this}re.prototype.clear=ep;re.prototype.delete=tp;re.prototype.get=rp;re.prototype.has=sp;re.prototype.set=np;function Xe(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var s=e[t];this.set(s[0],s[1])}}function ip(){this.__data__={hash:new Pe,map:new(Mt||re),string:new Pe}}function op(e){return Vr(this,e).delete(e)}function ap(e){return Vr(this,e).get(e)}function up(e){return Vr(this,e).has(e)}function cp(e,t){return Vr(this,e).set(e,t),this}Xe.prototype.clear=ip;Xe.prototype.delete=op;Xe.prototype.get=ap;Xe.prototype.has=up;Xe.prototype.set=cp;function Ze(e){this.__data__=new re(e)}function lp(){this.__data__=new re}function hp(e){return this.__data__.delete(e)}function dp(e){return this.__data__.get(e)}function fp(e){return this.__data__.has(e)}function pp(e,t){var r=this.__data__;if(r instanceof re){var s=r.__data__;if(!Mt||s.length<yf-1)return s.push([e,t]),this;r=this.__data__=new Xe(s)}return r.set(e,t),this}Ze.prototype.clear=lp;Ze.prototype.delete=hp;Ze.prototype.get=dp;Ze.prototype.has=fp;Ze.prototype.set=pp;function _p(e,t){var r=bn(e)||$p(e)?qf(e.length,String):[],s=r.length,i=!!s;for(var n in e)(t||le.call(e,n))&&!(i&&(n=="length"||Ip(n,s)))&&r.push(n);return r}function nu(e,t,r){var s=e[t];(!(le.call(e,t)&&uu(s,r))||r===void 0&&!(t in e))&&(e[t]=r)}function Gr(e,t){for(var r=e.length;r--;)if(uu(e[r][0],t))return r;return-1}function gp(e,t){return e&&iu(t,An(t),e)}function mn(e,t,r,s,i,n,o){var u;if(s&&(u=n?s(e,i,n,o):s(e)),u!==void 0)return u;if(!Wr(e))return e;var a=bn(e);if(a){if(u=Dp(e),!t)return Hp(e,u)}else{var h=Oe(e),l=h==yn||h==$a;if(Up(e))return Cp(e,t);if(h==En||h==vn||l&&!n){if(ru(e))return n?e:{};if(u=qp(l?{}:e),!t)return Op(e,gp(u,e))}else{if(!A[h])return n?e:{};u=Mp(e,h,mn,t)}}o||(o=new Ze);var c=o.get(e);if(c)return c;if(o.set(e,u),!a)var d=r?Pp(e):An(e);return Pf(d||e,function(p,_){d&&(_=p,p=e[_]),nu(u,_,mn(p,t,r,s,_,e,o))}),u}function mp(e){return Wr(e)?$f(e):{}}function vp(e,t,r){var s=t(e);return bn(e)?s:Df(s,r(e))}function yp(e){return Br.call(e)}function Ep(e){if(!Wr(e)||Lp(e))return!1;var t=lu(e)||ru(e)?Lf:Af;return t.test(De(e))}function Rp(e){if(!au(e))return Bf(e);var t=[];for(var r in Object(e))le.call(e,r)&&r!="constructor"&&t.push(r);return t}function Cp(e,t){if(t)return e.slice();var r=new e.constructor(e.length);return e.copy(r),r}function Cn(e){var t=new e.constructor(e.byteLength);return new Pa(t).set(new Pa(e)),t}function bp(e,t){var r=t?Cn(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.byteLength)}function Ap(e,t,r){var s=t?r(Ta(e),!0):Ta(e);return tu(s,Hf,new e.constructor)}function wp(e){var t=new e.constructor(e.source,bf.exec(e));return t.lastIndex=e.lastIndex,t}function Tp(e,t,r){var s=t?r(Sa(e),!0):Sa(e);return tu(s,Of,new e.constructor)}function Sp(e){return Ma?Object(Ma.call(e)):{}}function xp(e,t){var r=t?Cn(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.length)}function Hp(e,t){var r=-1,s=e.length;for(t||(t=Array(s));++r<s;)t[r]=e[r];return t}function iu(e,t,r,s){r||(r={});for(var i=-1,n=t.length;++i<n;){var o=t[i],u=s?s(r[o],e[o],o,r,e):void 0;nu(r,o,u===void 0?e[o]:u)}return r}function Op(e,t){return iu(e,ou(e),t)}function Pp(e){return vp(e,An,ou)}function Vr(e,t){var r=e.__data__;return Np(t)?r[typeof t=="string"?"string":"hash"]:r.map}function et(e,t){var r=Mf(e,t);return Ep(r)?r:void 0}var ou=Da?Rn(Da,Object):Gp,Oe=yp;(fn&&Oe(new fn(new ArrayBuffer(1)))!=Ur||Mt&&Oe(new Mt)!=$r||pn&&Oe(pn.resolve())!=Aa||_n&&Oe(new _n)!=Fr||gn&&Oe(new gn)!=dn)&&(Oe=function(e){var t=Br.call(e),r=t==En?e.constructor:void 0,s=r?De(r):void 0;if(s)switch(s){case Gf:return Ur;case Vf:return $r;case Wf:return Aa;case Yf:return Fr;case Kf:return dn}return t});function Dp(e){var t=e.length,r=e.constructor(t);return t&&typeof e[0]=="string"&&le.call(e,"index")&&(r.index=e.index,r.input=e.input),r}function qp(e){return typeof e.constructor=="function"&&!au(e)?mp(jf(e)):{}}function Mp(e,t,r,s){var i=e.constructor;switch(t){case Ga:return Cn(e);case La:case ja:return new i(+e);case Ur:return bp(e,s);case Va:case Wa:case Ya:case Ka:case za:case Ja:case Qa:case Xa:case Za:return xp(e,s);case $r:return Ap(e,s,r);case Fa:case ka:return new i(e);case Ua:return wp(e);case Fr:return Tp(e,s,r);case Ba:return Sp(e)}}function Ip(e,t){return t=t??Na,!!t&&(typeof e=="number"||wf.test(e))&&e>-1&&e%1==0&&e<t}function Np(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function Lp(e){return!!xa&&xa in e}function au(e){var t=e&&e.constructor,r=typeof t=="function"&&t.prototype||kr;return e===r}function De(e){if(e!=null){try{return su.call(e)}catch{}try{return e+""}catch{}}return""}function jp(e){return mn(e,!0,!0)}function uu(e,t){return e===t||e!==e&&t!==t}function $p(e){return Fp(e)&&le.call(e,"callee")&&(!Ff.call(e,"callee")||Br.call(e)==vn)}var bn=Array.isArray;function cu(e){return e!=null&&kp(e.length)&&!lu(e)}function Fp(e){return Bp(e)&&cu(e)}var Up=kf||Vp;function lu(e){var t=Wr(e)?Br.call(e):"";return t==yn||t==$a}function kp(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=Na}function Wr(e){var t=typeof e;return!!e&&(t=="object"||t=="function")}function Bp(e){return!!e&&typeof e=="object"}function An(e){return cu(e)?_p(e):Rp(e)}function Gp(){return[]}function Vp(){return!1}Qe.exports=jp});var Sn=f(se=>{"use strict";var du=se&&se.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(se,"__esModule",{value:!0});var H=T(),Wp=du(ba()),Yp=du(wn()),Tn;function Kp(){return process.env.LAYER0_CACHE==="true"}se.isCacheEnabled=Kp;function Yr(){return Tn||(Tn=new Wp.default),Tn}se.getCache=Yr;function zp(){Yr().reset()}se.clearCache=zp;function Jp(e){return Yr().get(e.toString())}se.getCachedResponse=Jp;function Qp({response:e,cacheKey:t,context:r}){var s;let i=(s=t.method)===null||s===void 0?void 0:s.toLowerCase();if(i&&!H.CACHEABLE_METHODS.has(i)&&r.cacheRouteMethod!==i)return e.setHeader(H.HTTP_HEADERS.x0CachingStatus,H.CACHING_STATUS.method),!1;if(t.body&&Buffer.from(t.body,"utf8").length>8e3)return e.setHeader(H.HTTP_HEADERS.x0CachingStatus,H.CACHING_STATUS.bodyTooBig),!1;if(e.statusCode&&e.statusCode>=400)return e.setHeader(H.HTTP_HEADERS.x0CachingStatus,H.CACHING_STATUS.code),!1;if(e.getHeader(H.HTTP_HEADERS.setCookie))return e.setHeader(H.HTTP_HEADERS.x0CachingStatus,H.CACHING_STATUS.setCookie),!1;let n=Zp(e);return n.private&&!r.forcePrivateCaching?(e.setHeader(H.HTTP_HEADERS.x0CachingStatus,H.CACHING_STATUS.private),!1):n.maxAge?(Yr().set(t.toString(),Xp(e),n.maxAge*1e3),e.setHeader(H.HTTP_HEADERS.x0CachingStatus,H.CACHING_STATUS.ok),!0):(e.setHeader(H.HTTP_HEADERS.x0CachingStatus,H.CACHING_STATUS.noMaxAge),!1)}se.maybeCacheResponse=Qp;function Xp(e){return{statusCode:e.statusCode,statusMessage:e.statusMessage,headers:Yp.default(e.getHeaders()),body:e.body}}function Zp(e){return{...{private:!1,maxAge:0},...hu(e.getHeader(H.HTTP_HEADERS.cacheControl)),...hu(e.getHeader(H.HTTP_HEADERS.x0CacheControl))}}function hu(e){let t={};if(e){Array.isArray(e)||(e=[e]);let r={};for(let s of e){let i=s.split(/,\s*/).map(n=>n.split(/=/));for(let[n,o]of i)n&&o&&(r[n.toLowerCase()]=o),n.toLowerCase()==="private"&&(t.private=!0);t.maxAge=parseInt(r["s-maxage"]||r["max-age"]||"0")}}return t}});var fu=f(Lt=>{"use strict";var e_=Lt&&Lt.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Lt,"__esModule",{value:!0});var he=T(),t_=e_(require("crypto")),Nt=class{constructor(t,r){var s;this.cookies={};let{host:i}=t.headers;if(this.body=t.body,this.method=(s=t.method)===null||s===void 0?void 0:s.toLowerCase(),this.query=this.excludeLayer0QueryParams(t.query||{}),this.pathname=new URL(t.url,`http://${i}`).pathname,this.headers=this.getDefaultHeaders(t.headers),r)for(let n of r.getActions())n(this,t)}static create(t,r){return new Nt(t,r)}excludeLayer0QueryParams(t){let r={};for(let s in t)s.startsWith("layer0_")||(r[s]=t[s]);return r}toSortedArray(t){return Object.keys(t).sort().map(r=>[r,t[r]])}getDefaultHeaders(t){return{[he.HTTP_HEADERS.host]:t[he.HTTP_HEADERS.host],[he.HTTP_HEADERS.acceptEncoding]:t[he.HTTP_HEADERS.acceptEncoding],[he.HTTP_HEADERS.x0Destination]:t[he.HTTP_HEADERS.x0Destination],[he.HTTP_HEADERS.x0Protocol]:t[he.HTTP_HEADERS.x0Protocol]}}toString(){return JSON.stringify({pathname:this.pathname,method:this.method,query:this.toSortedArray(this.query),body:r_(this.body),headers:this.toSortedArray(this.headers),cookies:this.toSortedArray(this.cookies)})}};Lt.default=Nt;function r_(e){if(!e)return null;let t=t_.default.createHash("sha256");return t.update(e),t.digest("hex")}});var pu=f(de=>{"use strict";var s_=de&&de.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(de,"__esModule",{value:!0});var n_=s_(ae()),xn,jt,Hn="info",On="warn",Pn="error";try{let e=n_.default("chalk"),t=e.hex("D355A7");jt=e.grey("Layer0"),xn=e.bold(`Layer${t("0")}`),Hn=e.cyan(Hn),On=e.yellow(On),Pn=e.red(Pn)}catch{xn=jt="Layer0"}de.infoLogLabel=`${jt} ${Hn} -`;de.warnLogLabel=`${jt} ${On} -`;de.errorLogLabel=`${jt} ${Pn} -`;de.default=xn});var zr=f(qe=>{"use strict";var j=qe&&qe.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(qe,"__esModule",{value:!0});var $t=j(require("fs")),i_=require("path"),tt=j(Ss()),Kr=j(ye()),o_=j(fo()),a_=j(Fs()),u_=j(la()),w=T(),_u=$e(),B=en(),gu=j(Lr()),c_=j(pa()),Ft=Sn(),l_=j(fu()),I=ns(),h_=j(sn()),mu=j(ae()),fe=pu(),d_=fs(),vu=j(wn()),f_=j(Ns()),p_=j(it());qe.FAR_FUTURE_TTL=60*60*24*365*10;var Dn=class extends d_.BaseResponseWriter{constructor(t,r,s,i){super(t,r,s),this.params={},this.streaming=!1,this.preCacheRequestActions=[],this.postCacheRequestActions=[],this.preCacheResponseActions=[],this.postCacheResponseActions=[],this.interpolateParams=n=>a_.default(this.request,this.response,n),this.redirect=(n,o={})=>{let{to:u,statusCode:a,query:h}=this._readRedirectParams(n,o),l=f_.default(this.request.url,tt.default(_u.isBrowser()?this.interpolateParams(gu.default.pathWithQueryString(u,h)):gu.default.pathWithQueryString(u,h),this.request.params));this.setResponseHeader(w.HTTP_HEADERS.location,l),this.send("",a)},this.proxy=async(n,o)=>{let u=Kr.default.get(`backends.${n}`);await this.proxyHost(u,o)},this.render=n=>{console.warn(`${fe.warnLogLabel} Warning ResponseWriter#render is deprecated.`),n(this.request,this.proxy,this.request.params)},this.renderWithApp=n=>this.proxy(w.BACKENDS.js,n),this.stream=n=>{if(process.env.NODE_ENV==="production")throw new Error("stream can only be used in development");let o=yu(Kr.default.get(`backends.${n}`));this.response.setHeader(w.HTTP_HEADERS.contentType,"text/event-stream"),this.streaming=!0,u_.default(this.request,this.response,o,Function.prototype),this.setCreateResponseAction(()=>Promise.resolve())},this.proxyHost=async(n,{path:o,transformRequest:u,transformResponse:a,headers:h,removeEmptySearchParamValues:l}={})=>{n=yu(n);let c=o_.default.create(n),d;typeof o=="function"?d=o():d=o,d=d&&tt.default(d,this.request.params),await this.setCreateResponseAction(async()=>{try{if(u){let _=new I.InternalTiming(I.InternalNames.transformRequest).start();try{await this.runImmediately(()=>u(this.request))}finally{_.end()}}let p=new I.InternalTiming(I.InternalNames.proxying).start();try{await c.fetch(this.request,this.response,{path:d||this.request.url,disableCheckCert:n.disableCheckCert,headers:h,removeEmptySearchParamValues:l})}finally{p.end()}if(a){let _=new I.InternalTiming(I.InternalNames.transformResponse).start();try{c_.default(this.response),await this.runImmediately(()=>a(this.response,this.request))}finally{_.end()}}}catch(p){p.type==="BackendFetchError"?(console.error(`${fe.errorLogLabel} Could not connect to backend ${n.domainOrIp}:`,p.message),this.response.statusCode=503):(console.error(`${fe.errorLogLabel} Error in ResponseWriter:`,p.message,p.stack),this.response.statusCode=500)}})},this.updatePath=n=>{let o=tt.default(n,this.request.params);Object.defineProperty(this.request,"path",{get:()=>o})},this.rewrite=(n,o)=>{let u=tt.default(n,this.request.params),a=new URL(this.request.url,"http://host");a.pathname=u,this.request.url=a.pathname+a.search,this.request.path=u,this.request.params=new h_.default(o).match(u)},this.serveStatic=async(n,o={})=>{let u=n&&tt.default(n,this.request.params),{permanent:a,exclude:h}=o;if(u=u.replace(/\/$/,""),h!=null&&h.some(l=>u.indexOf(l)>=0))return this.send("404 - Not found",404);if(_u.isCloud()){let l=Kr.default.get(`backends.${a?w.BACKENDS.permanentStatic:w.BACKENDS.static}`);await this.proxyHost(l,{path:p_.default(u),transformResponse:async c=>{c.setHeader(w.HTTP_HEADERS.cacheControl,`s-maxage=${qe.FAR_FUTURE_TTL}`),c.statusCode===403&&(o.loadingPage?await this.proxyHost(Kr.default.get(`backends.${w.BACKENDS.static}`),{path:tt.default(o.loadingPage,this.request.params)}):o.onNotFound?await o.onNotFound(this):(c.statusCode=404,c.statusMessage="Not Found")),o.statusCode&&(c.statusCode=o.statusCode),o.statusMessage&&(c.statusMessage=o.statusMessage)}})}else{if(!$t.default.existsSync(u))return this.send("404 - Not found",404);$t.default.lstatSync(u).isDirectory()&&(u=i_.join(u,"./index.html"));let l=$t.default.statSync(u),c=mu.default("mime-types"),d=mu.default("chardet"),p=c.lookup(u);if(p)try{let _=d.analyse($t.default.readFileSync(u));if(_.length>0){let{name:g,confidence:m}=_[0];g&&m>90&&(p+=`; charset=${g}`)}}catch{}else p="application/octet-stream";this.setUpstreamResponseHeader(w.HTTP_HEADERS.contentType,p),this.internalSetResponseHeader(w.HTTP_HEADERS.contentLength,l.size.toString(),!1,this.postCacheResponseActions),o.statusCode&&(this.response.statusCode=o.statusCode,this.response.statusMessage=o.statusMessage),await this.setCreateResponseAction(()=>new Promise((_,g)=>{$t.default.readFile(u,(m,b)=>{m?g(m):(this.response.body=b,_())})}))}},this.cache=n=>{let{browser:o,edge:u,key:a}=n;if(u){let{maxAgeSeconds:h,staleWhileRevalidateSeconds:l,forcePrivateCaching:c}=u,d=[];typeof c<"u"&&(this.context.forcePrivateCaching=c===!0),this.cacheKey=a,typeof this.route.criteria.method=="string"&&(this.context.cacheRouteMethod=this.route.criteria.method),h&&(d.push("max-age="+h),l&&d.push("stale-while-revalidate="+l)),d.length&&this.internalSetResponseHeader(w.HTTP_HEADERS.x0CacheControl,d.join(", "),!1,this.preCacheResponseActions)}if(o||o===!1){let{maxAgeSeconds:h,serviceWorkerSeconds:l}=o||{maxAgeSeconds:0};if(l&&h&&h>0)throw console.error(`${fe.errorLogLabel} Within the caching configuration of your "${this.route.criteria.path}" route, when service worker caching is set, the browser max age must be set to zero. Refer to https://docs.layer0.co/guides/caching#section_caching_a_response`),new Error("When service worker caching is set, the browser max age must be set to zero. Refer to https://docs.layer0.co/guides/caching#section_caching_a_response");h===0?this.setResponseHeader(w.HTTP_HEADERS.cacheControl,"private, no-store, no-cache"):h&&this.setResponseHeader(w.HTTP_HEADERS.cacheControl,`private, max-age=${h}`),l&&this.setResponseHeader(w.HTTP_HEADERS.xSwCacheControl,`max-age=${l}`)}},this.setResponseHeader=(n,o)=>{this.internalSetResponseHeader(n,o,!0,this.postCacheResponseActions)},this.internalSetResponseHeader=(n,o,u,a)=>{u&&B.validateSetResponseHeader(n),this.scheduleExecution(a,()=>{let h=this.interpolateParams(o);this.response.setHeader(n,h)})},this.updateResponseHeader=(n,o,u)=>{this.internalUpdateResponseHeader(n,o,u,this.preCacheResponseActions)},this.internalUpdateResponseHeader=(n,o,u,a)=>{B.validateUpdateResponseHeader(n),this.scheduleExecution(a,()=>{let h=this.response.getHeader(n),l=this.interpolateParams(u);h&&this.response.setHeader(n,h.replace(o,l))})},this.removeResponseHeader=n=>{this.internalRemoveResponseHeader(n,this.postCacheResponseActions)},this.internalRemoveResponseHeader=(n,o)=>{B.validateRemoveResponseHeader(n),this.scheduleExecution(o,()=>{this.response.removeHeader(n)})},this.getSetCookieValues=()=>{let n=this.response.getHeader(w.HTTP_HEADERS.setCookie);return typeof n=="string"?[n]:n||[]},this.getAddResponseCookieAction=(n,o,u={})=>()=>{let a=this.getSetCookieValues(),h=this.interpolateParams(o),l=`${n}=${h}`,c;for(c in u){let d=u[c];typeof d=="boolean"&&d?l+=`; ${c}`:l+=`; ${c}=${d}`}this.response.setHeader(w.HTTP_HEADERS.setCookie,[...a,l])},this.addUpstreamResponseCookie=(n,o,u)=>{B.validateCookieName(n),this.scheduleExecution(this.preCacheResponseActions,this.getAddResponseCookieAction(n,o,u))},this.addResponseCookie=(n,o,u)=>{B.validateCookieName(n),this.scheduleExecution(this.postCacheResponseActions,this.getAddResponseCookieAction(n,o,u))},this.getUpdateResponseCookieAction=(n,o,u)=>()=>{let a=this.getSetCookieValues().map(h=>{let[l,...c]=h.split("=");if(l!==n)return h;let d=c.join("=").replace(o,u);return[l,d].join("=")});this.response.setHeader(w.HTTP_HEADERS.setCookie,a)},this.updateUpstreamResponseCookie=(n,o,u)=>{B.validateCookieName(n),this.scheduleExecution(this.preCacheResponseActions,this.getUpdateResponseCookieAction(n,o,u))},this.updateResponseCookie=(n,o,u)=>{B.validateCookieName(n),this.scheduleExecution(this.postCacheResponseActions,this.getUpdateResponseCookieAction(n,o,u))},this.getRemoveResponseCookieAction=n=>()=>{let o=this.getSetCookieValues().filter(u=>u.split("=")[0]!==n);this.response.setHeader(w.HTTP_HEADERS.setCookie,o)},this.removeUpstreamResponseCookie=n=>{B.validateCookieName(n),this.scheduleExecution(this.preCacheResponseActions,this.getRemoveResponseCookieAction(n))},this.removeResponseCookie=n=>{B.validateCookieName(n),this.scheduleExecution(this.postCacheResponseActions,this.getRemoveResponseCookieAction(n))},this.setUpstreamResponseHeader=(n,o)=>{let u=n.toLowerCase()!=w.HTTP_HEADERS.x0SurrogateKey;return this.internalSetResponseHeader(n,o,u,this.preCacheResponseActions)},this.updateUpstreamResponseHeader=(n,o,u)=>this.internalUpdateResponseHeader(n,o,u,this.preCacheResponseActions),this.removeUpstreamResponseHeader=n=>this.internalRemoveResponseHeader(n,this.preCacheResponseActions),this.setRequestHeader=(n,o)=>{B.validateSetRequestHeader(n),this.scheduleExecution(this.postCacheRequestActions,()=>{this.request.headers[n.toLowerCase()]=o})},this.runImmediatelyDepthCounter=0,this.runImmediately=async n=>{try{++this.runImmediatelyDepthCounter,await n()}finally{--this.runImmediatelyDepthCounter}},this.scheduleExecution=(n,o)=>{this.runningImmediately?o():n.push(o)},this.updateRequestHeader=(n,o,u)=>{B.validateUpdateRequestHeader(n),this.scheduleExecution(this.postCacheRequestActions,()=>{let a=n.toLowerCase(),h=this.request.headers[a],l=this.interpolateParams(u);Array.isArray(h)?this.request.headers[a]=h.map(c=>c.replace(o,l)):h&&(this.request.headers[a]=h.replace(o,l))})},this.removeRequestHeader=n=>{B.validateRemoveRequestHeader(n),this.scheduleExecution(this.postCacheRequestActions,()=>{delete this.request.headers[n.toLowerCase()]})},this.serviceWorker=n=>{this.cache({edge:{maxAgeSeconds:30758400},browser:{maxAgeSeconds:0}}),this.serveStatic(n)},this.appShell=n=>{this.setResponseHeader(w.HTTP_HEADERS.contentType,"text/html"),this.serveStatic(n)},this.allowCors=(n={})=>{this.setResponseHeader("Access-Control-Allow-Origin",n.origin||"*"),n.methods&&this.setResponseHeader("Access-Control-Allow-Methods",n.methods.join(", ")),n.headers&&this.setResponseHeader("Access-Control-Allow-Headers",n.headers.join(", ")),n.maxAge&&this.setResponseHeader("Access-Control-Max-Age",n.maxAge.toString()),n.credentials!=null&&this.setResponseHeader("Access-Control-Allow-Credentials",n.credentials.toString())},this.send=(n,o=200,u)=>{this.setCreateResponseAction(async()=>{this.response.statusCode=o,this.response.statusMessage=u,typeof n=="function"?this.response.body=n():this.response.body=n})},this.compute=n=>{this.setCreateResponseAction(async()=>{await this.clearResponseAction().runImmediately(()=>n(this.request,this.response))})},this.onRouteError=n=>{let o={status:"error",message:n.message},u=n.isUserError;u&&console.error(`${fe.errorLogLabel} ${n.message}`),process.env.NODE_ENV!=="production"&&(o={message:`An error occured while running route ${this.route.toString()}: ${n.message}`,stack:u?void 0:n.stack,url:this.request.url});try{this.response.setHeader(w.HTTP_HEADERS.contentType,"application/json"),this.response.writeHead(500),this.response.end(JSON.stringify(o))}catch{console.error(`${fe.errorLogLabel} Could not write error response because headers have already been sent.`,o)}},this.request=t,this.response=r,this.route=s,this.context=i}async sendResponse({beforeResponse:t=()=>!0}={}){let r=!1;for(let n of this.preCacheRequestActions)n();let s,i;if(Ft.isCacheEnabled()&&(i=this.context.cacheKey||l_.default.create(this.request,this.cacheKey),s=Ft.getCachedResponse(i),this.cacheKey&&(this.context.cacheKey=i),!this.validatePrefetch(s)))return console.log(`${fe.infoLogLabel} throttle ${this.request.url}`),!0;if(s)r=!0,new I.InternalTiming(I.InternalNames.edgeCache).set(I.CacheValue.hit),this.applyCachedResponse(s);else{for(let o of this.postCacheRequestActions)o();this.createResponseAction&&(await this.createResponseAction(),r=!0);for(let o of this.preCacheResponseActions)o();if(!await t(this.response))return r}if(r&&!this.streaming&&!s&&Ft.isCacheEnabled()){let n=Ft.maybeCacheResponse({response:this.response,cacheKey:i,context:this.context});new I.InternalTiming(I.InternalNames.edgeCache).set(n?I.CacheValue.cached:I.CacheValue.pass)}for(let n of this.postCacheResponseActions)n();return r&&!this.streaming&&(this.logCacheStatus(),I.addTimings(this.response),this.response.statusCode&&this.response.writeHead(this.response.statusCode,this.response.statusMessage||void 0),this.response.end(this.response.body)),r}logCacheStatus(){if(Ft.isCacheEnabled()){let t=this.response.getHeader(w.HTTP_HEADERS.x0CachingStatus),r=I.getInternalTiming(I.InternalNames.edgeCache),{url:s}=this.request;console.log(`${fe.infoLogLabel} ${r} ${s}${t?` (${t})`:""}`)}}applyCachedResponse(t){this.response.statusCode=t.statusCode,this.response.statusMessage=t.statusMessage,this.response.body=vu.default(t.body);for(let r of Object.keys(t.headers))this.response.setHeader(r,vu.default(t.headers[r]))}validatePrefetch(t){return Object.keys(this.request.query||{}).includes(w.THROTTLED_QUERY_PARAM)&&!t?(this.response.writeHead(w.LAYER0_UNCACHED_PREFETCH_STATUS),this.response.end(),!1):!0}async setCreateResponseAction(t){if(this.runningImmediately)await t();else{if(this.createResponseAction!=null)throw new Error("You may only call one of the following once in your route handler: proxy, serveStatic, serviceWorker, redirect, send.");this.createResponseAction=t}}get runningImmediately(){return this.runImmediatelyDepthCounter>0}clearResponseAction(){return this.createResponseAction=void 0,this}};qe.default=Dn;function yu(e){return typeof e=="string"&&(e={domainOrIp:e}),e}});var Ru=f(kt=>{"use strict";var __=kt&&kt.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(kt,"__esModule",{value:!0});var Ut=require("os"),g_=T(),Eu=__(ye());function m_(e){if(Object.values(g_.BACKENDS).includes(e)||Eu.default.get(`backends.${e}`,!1))return;let t=Object.keys(Eu.default.get("backends"));throw t&&t.length?new Error(`To fix this problem use one of the "backends" configured in layer0.config.js:${Ut.EOL}${Ut.EOL} - ${t.join(`${Ut.EOL} - `)}${Ut.EOL}${Ut.EOL}or add "${e}" to the "backends" property in layer0.config.js.`):new Error(`Add "${e}" to the "backends" property in layer0.config.js.`)}kt.default=m_});var In=f(Me=>{"use strict";var v_=Me&&Me.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t},rt=Me&&Me.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Me,"__esModule",{value:!0});var Bt=v_(io()),y=T(),y_=rt(yr()),E_=rt(oo()),R_=rt(zr()),qn=rt(Lr()),C_=rt(Ru()),ne=en(),b_=ct(),A_=rt(it()),w_=60*60*24*365*10,Mn=class extends R_.default{constructor(t,r,s,i){super(t,r,s,i),this.stream=()=>{},this.setRequestHeader=(n,o)=>{ne.validateSetRequestHeader(n),this.edgeConfig.transform.request.push({action:y.ACTIONS.setHeader,name:n,value:o})},this.updateRequestHeader=(n,o,u)=>{ne.validateUpdateRequestHeader(n),this.edgeConfig.transform.request.push({action:y.ACTIONS.updateHeader,name:n,valueRegex:o.source,replaceValue:u})},this.removeRequestHeader=n=>{ne.validateRemoveRequestHeader(n),this.edgeConfig.transform.request.push({action:y.ACTIONS.removeHeader,name:n})},this.setResponseHeader=(n,o)=>{ne.validateSetResponseHeader(n),this.edgeConfig.transform.response.push({action:y.ACTIONS.setHeader,name:n,value:o})},this.updateResponseHeader=(n,o,u)=>{ne.validateUpdateResponseHeader(n),this.edgeConfig.transform.response.push({action:y.ACTIONS.updateHeader,name:n,valueRegex:o.source,replaceValue:u})},this.removeResponseHeader=n=>{ne.validateRemoveResponseHeader(n),this.edgeConfig.transform.response.push({action:y.ACTIONS.removeHeader,name:n})},this.setUpstreamResponseHeader=(n,o)=>{n.toLowerCase()!=y.HTTP_HEADERS.x0SurrogateKey&&ne.validateSetResponseHeader(n),this.edgeConfig.transform.upstreamResponse.push({action:y.ACTIONS.setHeader,name:n,value:o})},this.updateUpstreamResponseHeader=(n,o,u)=>{ne.validateUpdateResponseHeader(n),this.edgeConfig.transform.upstreamResponse.push({action:y.ACTIONS.updateHeader,name:n,valueRegex:o.source,replaceValue:u})},this.removeUpstreamResponseHeader=n=>{ne.validateRemoveResponseHeader(n),this.edgeConfig.transform.upstreamResponse.push({action:y.ACTIONS.removeHeader,name:n})},this.addResponseCookie=(n,o)=>{this.edgeConfig.transform.response.push({action:y.ACTIONS.addCookie,name:n,value:o})},this.updateResponseCookie=(n,o,u)=>{this.edgeConfig.transform.response.push({action:y.ACTIONS.updateCookie,name:n,valueRegex:o.source,replaceValue:u})},this.removeResponseCookie=n=>{this.edgeConfig.transform.response.push({action:y.ACTIONS.removeCookie,name:n})},this.addUpstreamResponseCookie=(n,o)=>{this.edgeConfig.transform.upstreamResponse.push({action:y.ACTIONS.addCookie,name:n,value:o})},this.updateUpstreamResponseCookie=(n,o,u)=>{this.edgeConfig.transform.upstreamResponse.push({action:y.ACTIONS.updateCookie,name:n,valueRegex:o.source,replaceValue:u})},this.removeUpstreamResponseCookie=n=>{this.edgeConfig.transform.upstreamResponse.push({action:y.ACTIONS.removeCookie,name:n})},this.redirect=(n,o={})=>{let{to:u,statusCode:a,query:h}=this._readRedirectParams(n,o),l=!E_.default(h),c=Bt.getBackReferences(qn.default.pathWithQueryString(u,h));if(this.shouldParseQueryString(c)||l){this.cache({edge:{maxAgeSeconds:w_}}),this.proxy(y.BACKENDS.js);return}if(this.setEdgeRoute({action:y.ACTIONS.syntheticRes,statusCode:a}),this.edgeConfig.transform.response.push({action:y.ACTIONS.setHeader,name:y.HTTP_HEADERS.location,value:"${url}"}),this.route.criteria.path){let p=qn.default.toEdgeRegexString(this.route.criteria.path+"{(\\?[^#]+)}?"),_=Bt.getBackReferences(this.route.criteria.path),g=Bt.default(this.route.criteria.path,u)+`\\${Object.keys(_).length+1}`;this.edgeConfig.transform.response.push({action:y.ACTIONS.updateHeader,name:y.HTTP_HEADERS.location,valueRegex:p,replaceValue:g})}else this.edgeConfig.transform.response.push({action:y.ACTIONS.updateHeader,name:y.HTTP_HEADERS.location,valueRegex:qn.default.toEdgeRegexString("([^?]*){(\\?[^#]+)}?"),replaceValue:`${u}\\2`})},this.serveStatic=(n,{permanent:o,exclude:u,onNotFound:a,loadingPage:h,expiresSeconds:l,statusCode:c,statusMessage:d,disableAutoPublish:p}={})=>{n&&!n.startsWith("/")&&(n=`/${n}`);let _=[],g;h&&(_.push(h),g={valueRegex:this.route.toEdgeRegexString(),replaceValue:Bt.default(this.route.criteria.path,h)}),n&&this.updatePath(A_.default(n)),typeof n=="string"&&_.push(n);let m=o===!0||y_.default(o,"enabled")||!1;return this.setEdgeRoute({action:y.ACTIONS.proxy,backend:m?y.BACKENDS.permanentStatic:y.BACKENDS.static,fsPath:_,fsExclude:u,fallbackToCompute:a!=null,loadingPage:g,expiresSeconds:l,statusMessage:d,statusCode:c,disableAutoPublish:p}),Promise.resolve()},this.verifyJwt=n=>(this.edgeConfig.jwtVerification=n,Promise.resolve()),this.proxy=(n,{path:o,transformResponse:u,transformRequest:a}={})=>(C_.default(n),u!=null||a!=null||typeof o=="function"?n=y.BACKENDS.js:typeof o=="string"&&this.updatePath(o),this.setEdgeRoute({action:y.ACTIONS.proxy,backend:n}),Promise.resolve()),this.updatePath=n=>{let o=Bt.default(this.route.criteria.path,n);o[0]!=="/"&&(o=`/${o}`),this.edgeConfig.transform.request.push({action:y.ACTIONS.updatePath,valueRegex:this.route.toEdgeRegexString(),replaceValue:o})},this.cache=n=>{let{edge:o,browser:u,key:a}=n;if(o){let{maxAgeSeconds:h,staleWhileRevalidateSeconds:l,forcePrivateCaching:c}=o;this.edgeConfig.cache={maxAgeSeconds:h,staleWhileRevalidateSeconds:l,forcePrivateCaching:c}}else o===!1&&(this.edgeConfig.cache={disabled:!0});if(a&&(this.edgeConfig.cache||(this.edgeConfig.cache={}),this.edgeConfig.cache.customKey=a.toJSON()),u||u===!1){let{maxAgeSeconds:h,serviceWorkerSeconds:l}=u||{maxAgeSeconds:0};if(l&&h&&h>0)throw new Error("When service worker caching is set, the browser max age must be set to zero. Refer to https://docs.layer0.co/guides/caching#section_caching_a_response");h===0?this.edgeConfig.transform.response.push({action:y.ACTIONS.setHeader,name:y.HTTP_HEADERS.cacheControl,value:"private, no-store, no-cache"}):h&&this.edgeConfig.transform.response.push({action:y.ACTIONS.setHeader,name:y.HTTP_HEADERS.cacheControl,value:`private, max-age=${h}`}),l&&this.edgeConfig.transform.response.push({action:y.ACTIONS.setHeader,name:y.HTTP_HEADERS.xSwCacheControl,value:`max-age=${l}`})}},this.send=(n,o,u)=>{typeof n=="function"?this.render():this.setEdgeRoute({action:y.ACTIONS.syntheticRes,statusCode:o,statusMessage:u,content:n})},this.compute=n=>{this.setEdgeRoute({action:y.ACTIONS.proxy,backend:y.BACKENDS.js})},this.render=()=>(this.setEdgeRoute({action:y.ACTIONS.proxy,backend:y.BACKENDS.js}),Promise.resolve()),this.edgeConfig={transform:{request:[],upstreamResponse:[],response:[]}}}shouldParseQueryString(t){let r=this.route.criteria.query;return r===void 0?!1:Object.keys(r).some(s=>{let i=r[s];return b_.isParamMatcher(i)&&!!t[s]})}setEdgeRoute(t){this.edgeConfig.route=t,this.edgeConfig.transform.upstreamResponse.push({action:y.ACTIONS.setHeader,name:y.HTTP_HEADERS.vary,value:y.HTTP_HEADERS.acceptEncoding})}};Me.default=Mn});var jn=f(Ln=>{"use strict";Object.defineProperty(Ln,"__esModule",{value:!0});var Nn=class{constructor(){this.forcePrivateCaching=!1}};Ln.default=Nn});var Cu=f(Gt=>{"use strict";var T_=Gt&&Gt.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Gt,"__esModule",{value:!0});var S_=T_(In()),$n=class extends S_.default{constructor(){super(...arguments),this.proxy=(t,r={})=>{throw new Error("Proxy cannot be used inside router.catch()")}}};Gt.default=$n});var bu=f((av,x_)=>{x_.exports={_from:"@layer0/core@latest",_id:"@layer0/core@4.19.3",_inBundle:!1,_integrity:"sha512-OY0hMjAkjvOH/Jeod7YauSZETIAlD//LoAY4pg7vXWj5YsmwxcTKrhzO6pb3hE+Nov6ujKmVB8+c9ZsooI7ZdQ==",_location:"/@layer0/core",_phantomChildren:{"array-union":"2.1.0","dir-glob":"3.0.1","fast-glob":"3.2.12",ignore:"5.2.0",merge2:"1.4.1",slash:"3.0.0"},_requested:{type:"tag",registry:!0,raw:"@layer0/core@latest",name:"@layer0/core",escapedName:"@layer0%2fcore",scope:"@layer0",rawSpec:"latest",saveSpec:null,fetchSpec:"latest"},_requiredBy:["#DEV:/","#USER","/@layer0/prefetch"],_resolved:"https://registry.npmjs.org/@layer0/core/-/core-4.19.3.tgz",_shasum:"0866d0adf8ce7a0bd3ef567eaa7c63001271c766",_spec:"@layer0/core@latest",_where:"/home/sfersobe-dilone/layer0sites/atom_website_design",bundleDependencies:!1,dependencies:{"@babel/parser":"^7.18.9","@babel/traverse":"^7.18.9","@types/lodash.clonedeep":"^4.5.6",ajv:"^6.12.6","babel-loader":"^8.2.2",chalk:"^4.1.2",chardet:"^1.4.0",chokidar:"^3.5.1","cls-hooked":"^4.2.2","content-type":"^1.0.4",cookie:"^0.4.1","cross-spawn":"^7.0.3","decode-uri-component":"^0.2.0",deepmerge:"^4.2.2",esbuild:"^0.14.49",express:"^4.17.1","fs-extra":"^8.1.0",globby:"^11.0.2","http-proxy":"^1.18.1","lodash.clonedeep":"^4.5.0","lru-cache":"^6.0.0","mime-types":"^2.1.35","node-fetch":"^2.6.1","path-to-regexp":"^6.2.0",pino:"^6.13.3",qs:"^6.10.1","resolve-package-path":"^4.0.3",semver:"^7.3.5",shelljs:"^0.8.5",slash:"^3.0.0","tcp-port-used":"^1.0.2","ts-loader":"^8.2.0",unixify:"^1.0.0",uuid:"^8.3.2"},deprecated:!1,description:"Core library for the [Layer0](https://docs.layer0.co), infrastructure to run your big, dynamic website frontend and make it load in less than one second.",devDependencies:{"@types/cls-hooked":"^4.3.1","@types/content-type":"^1.1.3","@types/cookie":"^0.3.3","@types/cross-spawn":"^6.0.2","@types/decode-uri-component":"^0.2.0","@types/express":"^4.17.7","@types/fs-extra":"^8.1.1","@types/http-proxy":"^1.17.4","@types/jest":"^26.0.23","@types/lodash":"^4.14.162","@types/lru-cache":"^5.1.0","@types/mime-types":"^2.1.0","@types/node":"^14.6.4","@types/route-parser":"^0.1.3","@types/semver":"^7.3.9","@types/shelljs":"^0.8.8","@types/tcp-port-used":"^1.0.0","@types/unixify":"^1.0.0","@types/uuid":"^8.0.1","@types/webpack-bundle-analyzer":"^3.9.0",lodash:"^4.17.21",nock:"^13.2.8",stripe:"^9.12.0",webpack:"^5.27.0","webpack-bundle-analyzer":"^3.9.0","webpack-dev-middleware":"^4.1.0"},jest:{clearMocks:!0,collectCoverage:!0,transform:{"^.+\\.(js)?$":"babel-jest","^.+\\.ts$":"ts-jest"},moduleFileExtensions:["ts","js","json"],setupFilesAfterEnv:["<rootDir>/test/jest.js"],transformIgnorePatterns:["<rootDir>/node_modules/"],moduleNameMapper:{"../package.json":"<rootDir>/package.json","^@layer0/core(.*)$":"<rootDir>/src/$1"},collectCoverageFrom:["./src/**/*.{ts,js}","!**/mocks/**","!**/test-utils/**","!**/index.ts","!**/src/types.ts","!**/plugins/PluginBase.ts","!**/bin/**/*"]},license:"UNLICENSED",main:"./index.js",name:"@layer0/core",publishConfig:{directory:"dist"},scripts:{build:"rm -rf ./dist; mkdir ./dist; cp -r package.json README.md serverless.yml default-app ./dist; tsc; npm run bundle-handler;","bundle-handler":"esbuild src/lambda/handler.ts --bundle --minify --platform=node --target=node14.0 --outfile=dist/lambda/handler.js --log-level=error --sourcemap",docs:"typedoc","push-build":"npm run build && cd dist && yalc push --force && cd ..",release:"cd ./dist; npm publish --access public","release:next":"npm run release -- --tag next",test:"jest --watchAll=false --runInBand --forceExit","ts:watch":"tsc --watch",watch:"npm-watch"},version:"4.19.3",watch:{"push-build":{patterns:["src","bin","serverless.yml","default-app","package.json"],extensions:["js","ts"],quiet:!1}}}});var Ou=f(Wt=>{"use strict";var Ie=Wt&&Wt.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Wt,"__esModule",{value:!0});var H_=Ie(ye()),Au=Ie(Cr()),O_=Ie(Xi()),Vt=Ie(eo()),P_=Ie(In()),xu=T(),wu=Ie(jn()),D_=ct(),q_=Ie(Cu());function M_({edgeConfig:e},t){var r,s;return e.cache&&((r=e.cache)===null||r===void 0?void 0:r.maxAgeSeconds)&&((s=e.cache)===null||s===void 0?void 0:s.maxAgeSeconds)>0&&t?{...e.cache,matchExplicitMethod:t}:e.cache}function I_({edgeConfig:e},t){var r;let s=e.route;return((r=e.route)===null||r===void 0?void 0:r.action)===xu.ACTIONS.syntheticRes&&!e.route.statusCode&&!t&&(e.route.statusCode=200),s}function N_({edgeConfig:e}){return e.transform}function L_({edgeConfig:e}){return e.jwtVerification}function Hu(e){return Object.entries(e).reduce((t,[r,s])=>(s instanceof RegExp?t[r]=Vt.default(s):typeof s=="object"&&s!==null?t[r]=Hu(s):t[r]=Vt.default(s),t),{})}function j_(e){var t;let r=[],s=[],i,n;if(e.criteria.protocol){let o;if(typeof e.criteria.protocol=="string"?o=new RegExp(`^${e.criteria.protocol}$`,"i"):o=new RegExp(e.criteria.protocol),!o.test("http")&&!o.test("https"))throw new Error('Protocol matcher must match either "http" or "https"');i=o.source}if(e.criteria.path&&r.push({value:"${path}",matchRegex:e.toEdgeRegexString()}),e.criteria.method){let o;typeof e.criteria.method!="string"?o=e.criteria.method:(o=O_.default(e.criteria.method),Object.values(xu.HTTP_METHODS).includes(e.criteria.method)&&(n=e.criteria.method)),r.push({value:"${method}",matchRegex:Au.default(o)})}return e.criteria.headers&&Object.entries(e.criteria.headers).forEach(([o,u])=>{r.push({value:`\${req:${o}}`,matchRegex:Vt.default(u)})}),!((t=e.criteria.response)===null||t===void 0)&&t.statusCode&&s.push({value:"${res:status}",matchRegex:Au.default(e.criteria.response.statusCode)}),e.criteria.query&&Object.entries(e.criteria.query).forEach(([o,u])=>{D_.isParamMatcher(u)||r.push({value:`\${query:${o}}`,matchRegex:Vt.default(u)})}),e.criteria.cookies&&Object.entries(e.criteria.cookies).forEach(([o,u])=>{r.push({value:`\${req:cookie:${o}}`,matchRegex:Vt.default(u)})}),e.criteria.body&&r.push({matchBody:JSON.stringify({parse:e.criteria.body.parse,criteria:Hu(e.criteria.body.criteria)})}),{match:r,matchResp:s,matchExplicitMethod:n,matchProtocolJavaScriptRegExpSource:i}}async function $_(e){let t={};if(!Object.keys(e.getDestinations()).length)t={default:await Su(e)};else for(let r in e.getDestinations())t[r]=await Su(e.getDestinations()[r]);return{version:F_(),backends:{...H_.default.get("backends")},destinations:t}}Wt.default=$_;function F_(){return bu().version}async function Tu(e,t,r,s){try{await e.handler(t)}catch(a){Error.captureStackTrace(a),r.push({route:e.toString(),stackTrace:a.stack})}let{match:i,matchResp:n,matchExplicitMethod:o,matchProtocolJavaScriptRegExpSource:u}=j_(e);return{path:e.criteria.path,routeJson:e.toJson(),match:i,matchResp:n,matchProtocolJavaScriptRegExpSource:u,cache:M_(t,o),route:I_(t,s),transform:N_(t),jwtVerification:L_(t)}}async function Su(e){let t=[],r={index:e.index,errorRoutes:await Promise.all(e.getRouteGroups().getRoutes().filter(s=>s.isRespRoute()).map(s=>Tu(s,new q_.default({url:"",headers:{}},{},s,new wu.default),t,!0))),routes:await Promise.all(e.getRouteGroups().getRoutes().filter(s=>!s.isRespRoute()).map(s=>Tu(s,new P_.default({url:"",headers:{}},{},s,new wu.default),t,!1)))};if(t.length){let s=`
Errors occurred while attempting to deploy your application to Layer0 edge.
The following ${t.length>1?"routes":"route"} could not be processed:`;throw t.forEach(({route:i,stackTrace:n})=>{s=s.concat(`
* ${i}: ${n}`)}),new Error(s)}return r}});var Pu=f(Fn=>{"use strict";Object.defineProperty(Fn,"__esModule",{value:!0});function U_(e,t){if(!e||!e.length)return;let r,s,i=!1;for(let n of e){if(!i){r=n,t&&(s=t(n)),i=!0;continue}if(t){let o=t(n);o<s&&(r=n,s=o)}else n<r&&(r=n)}return r}Fn.default=U_});var Du=f(kn=>{"use strict";Object.defineProperty(kn,"__esModule",{value:!0});var Un=class{constructor(){this._tasks=[],this._resolveHandler=Function.prototype,this._errorHandler=t=>{throw t}}add(...t){return this._tasks.push(...t),this}onTaskDone(t){return this._resolveHandler=t,this}onTaskError(t){return this._errorHandler=t,this}resolve(){let t=this._convertTasksToPromises().map((r,s)=>r.then(i=>(this._resolveHandler(i),i)).catch(i=>this._errorHandler(i)));return Promise.all(t)}_convertTasksToPromises(){return this._tasks.map(t=>{if(typeof t!="function")return Promise.resolve(t);try{let r=t();return r instanceof Promise?r:Promise.resolve(r)}catch(r){return Promise.reject(r)}})}};kn.default=Un});var Iu=f(Yt=>{"use strict";var Mu=Yt&&Yt.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Yt,"__esModule",{value:!0});var k_=Mu(ye()),qu=Mu(Du()),st=class{constructor(){this.options=[]}push(...t){this.options.push(...t)}static async resolveDestinationPreloadConfig(t,r){let s=[];return await new qu.default().add(...t.preloadRequests.options).onTaskDone(i=>{s.push(...i.map(n=>({...n,destination:r})))}).resolve(),{requests:s}}static async resolvePreloadConfig(t){let r=[],s=new qu.default,i=t.getDestinations();if(!Object.keys(i).length)s.add(st.resolveDestinationPreloadConfig(t,"default"));else for(let n in i)s.add(st.resolveDestinationPreloadConfig(i[n],n));return await s.onTaskDone(({requests:n})=>{r.push(...n)}).resolve(),{requests:r,concurrency:k_.default.get("prerenderConcurrency",null)}}};Yt.default=st});var Nu=f(Bn=>{"use strict";Object.defineProperty(Bn,"__esModule",{value:!0});function B_(e){return new Promise((t,r)=>{let s=[];e.on("data",i=>i&&s.push(i)),e.on("end",()=>{t(Buffer.concat(s))}),e.on("abort",i=>{r(i)})})}Bn.default=B_});var Lu=f(Jr=>{"use strict";Object.defineProperty(Jr,"__esModule",{value:!0});function G_(){return process.env.LAYER0_ROOT_SOURCE_DIR||process.cwd()}Jr.getSourceDir=G_;function V_(e){process.env.LAYER0_ROOT_SOURCE_DIR=e}Jr.setSourceDir=V_});var $u=f(Kt=>{"use strict";var W_=Kt&&Kt.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Kt,"__esModule",{value:!0});var ju=W_(ae());function Y_(e){try{let t=require.resolve(e,{paths:[require.resolve("@layer0/core")]});return ju.default(t)}catch{return ju.default(e)}}Kt.default=Y_});var Wn=f(ie=>{"use strict";var Jt=ie&&ie.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(ie,"__esModule",{value:!0});var K_=Jt(Lr()),z_=Sn(),Gn=$e(),Fu=require("path"),J_=Jt(ae()),Q_=Jt(rn()),zt=T(),X_=Lu(),Uu=Jt(it()),Z_=Jt($u());ie.staticAssetManifest={};ie.STATIC_ASSET_MANIFEST_FILE="static-asset-manifest.json";var Vn=class{constructor(t){if(this._routes=[],!t)throw new Error("Route group name is required!");this.name=t}match(t,r,{index:s,label:i}={}){let n=new K_.default(t,r,{label:i});return s!=null?this._routes.splice(s,0,n):this._routes.push(n),this}dir(t,r){let s=Fu.join(X_.getSourceDir(),t),i=ie.staticAssetManifest[Uu.default(t)]=[],{ignore:n,label:o}=r;typeof n=="string"&&(n=[n]);let u=Gn.isCloud()?this.staticAssetsForPath(t):Z_.default("globby").sync(r.glob||"**/*",{cwd:s,onlyFiles:!0,ignore:n||[]});r.sort&&(u=r.sort(u));for(let a of u){let h=r.paths&&r.paths(a)||[`/${a}`];Gn.isCloud()||i.push(Uu.default(a));for(let l of h){let c=l.replace(/\/index.html$/,"");c.length===0&&(c="/"),this.match(c,async d=>{r.handler&&r.handler(a)(d)},{label:o})}}return this}static(t,r){let s=i=>n=>{r.handler&&r.handler(i)(n),n.serveStatic(`${t}/${i}`)};return this.dir(t,{...r,handler:s,label:`static('${t}')`})}requireBasicAuth(t){let{route:r,username:s,password:i,realm:n="Access to the site"}=t;if(s&&i){let o=Buffer.from(`${s}:${i}`).toString("base64");r=Q_.default(r),this.match({...r,headers:{...r.headers,[zt.HTTP_HEADERS.authorization]:null,[zt.HTTP_HEADERS.x0MatchedRoutes]:null}},({send:u,setResponseHeader:a})=>{a("WWW-Authenticate",`Basic realm="${n}"`),u("",401,"Unauthorized")}).match({...r,headers:{...r.headers,[zt.HTTP_HEADERS.authorization]:new RegExp(`^((?!Basic ${o}).)*$`),[zt.HTTP_HEADERS.x0MatchedRoutes]:null}},({send:u})=>{u("",403,"Forbidden")}).match({...r,headers:{...r.headers,[zt.HTTP_HEADERS.x0MatchedRoutes]:null}},({removeRequestHeader:u})=>{u("authorization")})}return this}staticAssetsForPath(t){return J_.default(Fu.join(process.cwd(),ie.STATIC_ASSET_MANIFEST_FILE))[t]}clear(){return this._routes=[],Gn.isCloud()||z_.clearCache(),this}get routes(){return this._routes}get length(){return this._routes.length}};ie.default=Vn});var ku=f(Qt=>{"use strict";var eg=Qt&&Qt.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Qt,"__esModule",{value:!0});var tg=eg(Wn()),rg=T(),Yn=class{constructor(){this.routeGroups=[]}add(t){return this.routeGroups.push(t),this}getGroups(){return this.routeGroups}findByName(t){return this.routeGroups.find(r=>r.name===t)}getRoutes(){let t=[];return this.getGroups().forEach(r=>{t=t.concat(r.routes)}),this.fallback&&(t=t.concat(this.fallback.routes)),t}setFallback(t){let r=new tg.default(rg.ROUTES_FALLBACK);r.match(null,t),this.fallback=r}get length(){return this.routeGroups.length}};Qt.default=Yn});var Wu=f(Le=>{"use strict";var Y=Le&&Le.__importDefault||function(e){return e&&e.__esModule?e:{default:e}},sg=Le&&Le.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(Le,"__esModule",{value:!0});var v=T(),Bu=ns(),ng=xi(),ig=Y(Fi()),og=Y(Ui()),ag=Y(ye()),ug=Y(Ou()),cg=Y(Fs()),lg=Y(Pu()),Gu=Y(Iu()),hg=Y(Nu()),dg=Y(jn()),fg=Y(zr()),Vu=sg(Wn()),pg=Y(ku()),_g=/\bbr\b/,gg=/\bgzip\b/,Ne=class{constructor(t={excludeBuiltInRoutes:!1,allowReqQueryDuplicates:!1}){var r;this.routeGroups=new pg.default,this.preloadRequests=new Gu.default,this.plugins=[],this.destinations={},this.nextRouterIndex=0,this._index=0,this.processRequestHeaders=s=>{s.headers[v.HTTP_HEADERS.xRequestId]||(this.newRequestId=ng.v4(),s.headers[v.HTTP_HEADERS.xRequestId]=this.newRequestId);let i=s.headers[v.HTTP_HEADERS.acceptEncoding];if(typeof i=="string"){let u=gg.test(i),a=_g.test(i);u&&a?i=`${v.GZIP_ENCODING}, ${v.BROTLI_ENCODING}`:u?i=v.GZIP_ENCODING:a?i=v.BROTLI_ENCODING:i=null}else i=null;i?s.headers[v.HTTP_HEADERS.acceptEncoding]=i:delete s.headers[v.HTTP_HEADERS.acceptEncoding];let n=s.connection,o="127.0.0.1";if(n&&n.remoteAddress){if(o=n.remoteAddress,s.headers[v.HTTP_HEADERS.x0Protocol]!=="http"){let u=s.headers[v.HTTP_HEADERS.cookie];typeof u=="string"&&/\blocal_layer0_emulate_http_protocol=true\b/.test(u)?s.headers[v.HTTP_HEADERS.x0Protocol]="http":s.headers[v.HTTP_HEADERS.x0Protocol]="https"}}else s.headers[v.HTTP_HEADERS.x0Protocol]||(s.headers[v.HTTP_HEADERS.x0Protocol]="https");s.headers[v.HTTP_HEADERS.xForwardedFor]?s.headers[v.HTTP_HEADERS.xForwardedFor]=`${s.headers[v.HTTP_HEADERS.xForwardedFor]}, ${o}`:s.headers[v.HTTP_HEADERS.xForwardedFor]=`${o}`,s.headers[v.HTTP_HEADERS.x0ClientIp]||(s.headers[v.HTTP_HEADERS.x0ClientIp]=s.headers[v.HTTP_HEADERS.xForwardedFor].split(",")[0]),Ne.isRequestFromEdge(s)||(this.processRequestDeviceHeaders(s),this.processRequestGeoHeaders(s))},this.processRequestDeviceHeaders=s=>{let i="desktop",n="generic",o=!1,u="generic",a=(s.headers[v.HTTP_HEADERS.userAgent]||"").toLowerCase();/ipad/.test(a)?(i="tablet",n="apple"):/ip(hone|od)/.test(a)?(i="smartphone",n="apple"):/android.*(mobile|mini)/.test(a)?(i="smartphone",n="android"):/android/.test(a)?(i="tablet",n="android"):/opera mobi/.test(a)?(i="smartphone",n="android"):/playbook u rim tablet/.test(a)?(i="tablet",n="blackberry"):/hp-tablet.*touchpad/.test(a)?(i="tablet",n="hp"):/kindle\/3/.test(a)?(i="tablet",n="kindle"):/mobile.+firefox/.test(a)?(i="mobile",n="firefoxos"):/^htc/.test(a)?(i="smartphone",n="htc"):/fennec/.test(a)?(i="smartphone",n="fennec"):/iemobile/.test(a)?(i="smartphone",n="microsoft"):/blackberry/.test(a)||/bb10.*mobile/.test(a)?(i="smartphone",n="blackberry"):/gt-.*build\/gingerbread/.test(a)?(i="smartphone",n="android"):/symbianos.*applewebkit/.test(a)?(i="smartphone",n="symbian"):(/symbian/.test(a)||/^sonyericsson/.test(a)||/^nokia/.test(a)||/^samsung/.test(a)||/^lg/.test(a)||/bada/.test(a)||/blazer/.test(a)||/cellphone/.test(a)||/midp-2.0/.test(a)||/u990/.test(a)||/netfront/.test(a)||/opera mini/.test(a)||/palm/.test(a)||/nintendo wii/.test(a)||/playstation portable/.test(a)||/portalmmm/.test(a)||/proxinet/.test(a)||/sonyericsson/.test(a)||/windows ?ce/.test(a)||/winwap/.test(a)||/eudoraweb/.test(a)||/240x320/.test(a)||/avantgo/.test(a))&&(i="mobile"),/bot/.test(a)||/crawler/.test(a)||/headless/.test(a)||/prerender/.test(a)||/preview/.test(a)||/scanner/.test(a)||/slurp/.test(a)||/spider/.test(a)||/(developers.google.com\/+\/web\/snippet|embedly|facebookexternalhit|flipboard|googlepagespeed|google page speed)/.test(a)||/(ia_archiver|moov-prerender-cache-exerciser|nuzzel|outbrain|pinterest|qwantify|tumblr|vkshare)/.test(a)||/(w3c_validator|whatsapp|xing-contenttabreceiver|yahoo)/.test(a)?o=!0:o=!1,/edge/.test(a)?u="edge":/chrome|chromium|crios/.test(a)?u="chrome":/firefox/.test(a)?u="firefox":/opera|opr/.test(a)?u="opera":/msie/.test(a)||/trident/.test(a)?u="msie":/safari/.test(a)&&(u="safari"),s.headers[v.HTTP_HEADERS.x0Device]=i,s.headers[v.HTTP_HEADERS.x0DeviceIsBot]=o?"1":"0",s.headers[v.HTTP_HEADERS.x0Vendor]=n,s.headers[v.HTTP_HEADERS.x0Browser]=u},this.processRequestGeoHeaders=s=>{s.headers[v.HTTP_HEADERS.x0GeoCity]="San Francisco",s.headers[v.HTTP_HEADERS.x0GeoCountryCode]="US",s.headers[v.HTTP_HEADERS.x0GeoLatitude]="37.792094",s.headers[v.HTTP_HEADERS.x0GeoLongitude]="-122.401622",s.headers[v.HTTP_HEADERS.x0GeoPostalCode]="94104"},this.processRequestBody=async s=>{s.rawBody=await hg.default(s),Object.defineProperty(s,"body",{configurable:!0,get(){return this.rawBody.toString("utf8")}})},this.isUserHeaderCountWithinLimits=s=>Object.keys(s).filter(n=>n.toLowerCase().indexOf(v.LAYER0_HEADERS_PREFIX)!==0).length<=v.LAYER0_MAX_USER_HEADERS_ALLOWED,this.patchResWriteHead=(s,i)=>{let n=i.writeHead;i.writeHead=(...o)=>{i.writeHead=n,this.newRequestId&&i.setHeader(v.HTTP_HEADERS.xRequestId,this.newRequestId);let a=o[2];if(a)for(let h of Object.keys(a))i.setHeader(h,cg.default(s,i,a[h]));if(this.isUserHeaderCountWithinLimits(i.getHeaders())){i.writeHead(...o);return}i.writeHead(v.LAYER0_TOO_MANY_HEADERS_STATUS_CODE,"Too many response headers")}},this.run=async(s,i)=>{let n=new Bu.InternalTiming(Bu.InternalNames.routeMatching).start(),o=this,u=new dg.default;if(this.processRequestHeaders(s),!this.isUserHeaderCountWithinLimits(s.headers)){i.writeHead(v.LAYER0_TOO_MANY_HEADERS_STATUS_CODE,"Too many request headers"),i.end();return}if(await this.processRequestBody(s),this.patchResWriteHead(s,i),Object.keys(this.destinations).length>1){let{LAYER0_ROUTER_DESTINATION:c}=process.env,d=s.headers[v.HTTP_HEADERS.x0Destination]||c;if(d||(d=lg.default(Object.keys(this.destinations),p=>this.destinations[p]._index)),o=this.destinations[d],!o)throw new Error(`Routing destination "${d}" not found.`)}o.plugins.forEach(c=>c.onRequest(s));let a=c=>{let d=new fg.default(s,i,c,u);return Ne.isRequestFromEdge(s)?og.default.create(d):d},h=o.routeGroups.getRoutes().filter(c=>!c.isRespRoute()),l=o.routeGroups.getRoutes().filter(c=>c.isRespRoute());for(let c of h){let d;try{if(n.resume(),!c.match(s))continue;if(n.pause(),d=a(c),await c.handler(d),await d.sendResponse({beforeResponse:async _=>{if(!Ne.isRequestFromEdge(s)){for(let g of l)if(n.resume(),!!g.matchResponse(_))return n.pause(),d=a(g),await g.handler(d),d.sendResponse(),!1}return!0}}))return}catch(p){d=d||a(s,i,c,u),d.onRouteError(p);return}}this.builtInFallback(s,i)},t.excludeBuiltInRoutes||ig.default(this),this.allowReqQueryDuplicates=(r=t.allowReqQueryDuplicates)!==null&&r!==void 0?r:!1}getStaticAssetManifest(){return Vu.staticAssetManifest}setBackend(t,r){return ag.default.get("backends")[t]=r,this}use(t){return t.onRegister(this),this.plugins.push(t),this}destination(t,r){return r.setIndex(this.nextRouterIndex++),this.destinations[t]=r,this}getPlugins(){let t=this.plugins;for(let r of Object.values(this.destinations))t=t.concat(r.getPlugins());return t}setIndex(t){this._index=t}get index(){return this._index}group(t,r){let s=new Vu.default(t);return r(s),this.routeGroups.add(s),this}match(t,r){return this.group("root",s=>s.match(t,r))}prerender(...t){return this.preloadRequests.push(...t),this}matchMethod(t,r,s){if(typeof r=="string")return this.match({method:t,path:r},s);if(r.method)throw new Error(`Invalid criteria property method passed to call to Router#${t}. Specifying a method in the criteria is redundant.`);return this.match({...r,method:t},s)}head(t,r){return this.matchMethod(v.HTTP_METHODS.head,t,r)}get(t,r){return this.matchMethod(v.HTTP_METHODS.get,t,r)}post(t,r){return this.matchMethod(v.HTTP_METHODS.post,t,r)}delete(t,r){return this.matchMethod(v.HTTP_METHODS.delete,t,r)}put(t,r){return this.matchMethod(v.HTTP_METHODS.put,t,r)}patch(t,r){return this.matchMethod(v.HTTP_METHODS.patch,t,r)}options(t,r){return this.matchMethod(v.HTTP_METHODS.options,t,r)}fallback(t){return this.routeGroups.setFallback(t),this}catch(t,r){let s;return t instanceof RegExp?s=t:s=new RegExp(`^${t.toString()}$`),this.group(v.ROUTES_CATCH_GROUP,i=>i.match({headers:{"x-0-error-status-code":s},response:{statusCode:s}},async n=>{await r(n),n.cache({edge:!1,browser:{maxAgeSeconds:0}})})),this}noIndexPermalink(){return this.group(v.ROUTES_NOINDEX_GROUP,t=>t.match({headers:{host:/layer0.link|layer0-perma.link/}},({setResponseHeader:r})=>{r("x-robots-tag","noindex")}))}builtInFallback(t,r){let s=t.connection;s&&s.remoteAddress?r.writeHead(404):t.headers[v.HTTP_HEADERS.x0Protocol]==="http"?(r.setHeader(v.HTTP_HEADERS.location,`https://${t.headers[v.HTTP_HEADERS.host]}${t.url}`),r.writeHead(301)):r.writeHead(404),r.end()}static(t,r={}){return this.group("root",s=>s.static(t,r))}graphqlOperation(t,r){if(typeof t=="string"||t instanceof RegExp)return this.post({path:"/graphql",body:{parse:"json",criteria:{operationName:t}}},r);{let{path:s,name:i}=t;return this.post({path:s,body:{parse:"json",criteria:{operationName:i}}},r)}}requireBasicAuth(t){return this.group("root",r=>r.requireBasicAuth(t))}createEdgeConfig(){return ug.default(this)}createPreloadConfig(){return Gu.default.resolvePreloadConfig(this)}getDestinations(){return this.destinations}getRouteGroups(){return this.routeGroups}toString(){return`Routes
======
`+this.routeGroups.getRoutes().map((t,r)=>`${r}:	${t.toString()}`).join(`
`)}static isRequestFromEdge(t){return typeof t.headers[v.HTTP_HEADERS.x0Version]=="string"}};Le.default=Ne});var Yu=f(zn=>{"use strict";Object.defineProperty(zn,"__esModule",{value:!0});var Kn=class{constructor(t){this.name=t}byPattern(t){this.pattern=t}toJSON(){if(!this.pattern)throw new Error("byPattern is required for group "+this.name);return{groupedValue:this.name,matchRegex:this.pattern.source}}};zn.default=Kn});var Ku=f(Xt=>{"use strict";var mg=Xt&&Xt.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Xt,"__esModule",{value:!0});var vg=mg(Yu()),Jn=class{constructor(){this.groups=[],this.name=null}group(t){let r=new vg.default(t);return this.groups.push(r),r}toJSON(){return this.groups.map(t=>t.toJSON())}};Xt.default=Jn});var Qn=f(G=>{"use strict";var yg=G&&G.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(G,"__esModule",{value:!0});var zu=yg(Ku()),Eg=Sr();G.CUSTOM_CACHE_KEY_ACTIONS={blacklistAll:"blacklist-all-query-parameters",blacklistSome:"blacklist-some-query-parameters",whitelistSome:"whitelist-some-query-parameters",addValue:"add-value",removeMethod:"remove-method",removeBody:"remove-body"};var Zt=class{constructor(){this.config=[],this.actions=[]}clone(){let t=new Zt;return t.actions=this.actions,t.config=this.config,t}excludeAllQueryParameters(){return this.config.push({action:G.CUSTOM_CACHE_KEY_ACTIONS.blacklistAll}),this.actions.push((t,r)=>{t.query={}}),this}excludeQueryParameters(...t){return this.config.push({action:G.CUSTOM_CACHE_KEY_ACTIONS.blacklistSome,names:t}),this.actions.push((r,s)=>{for(let i of t)delete r.query[i]}),this}excludeAllQueryParametersExcept(...t){return this.config.push({action:G.CUSTOM_CACHE_KEY_ACTIONS.whitelistSome,names:t}),this.actions.push((r,s)=>{let i=new Set(t);for(let n in r.query)i.has(n)||delete r.query[n]}),this}addHeader(t,r){return this.actions.push((s,i)=>{let n=i.headers[t];Array.isArray(n)||(n=[n]),r?s.headers[t]=this.createGroupedValue(r,n):s.headers[t]=n}),this.addValue(`\${req:${t}}`,r)}removeMethod(){return this.actions.push((t,r)=>{t.method=void 0}),this.config.push({action:G.CUSTOM_CACHE_KEY_ACTIONS.removeMethod}),this}removeBody(){return this.actions.push((t,r)=>{t.body=void 0}),this.config.push({action:G.CUSTOM_CACHE_KEY_ACTIONS.removeBody}),this}createGroupedValue(t,r){let s=new zu.default,i=[];t(s);let n=this.findMatchingGroup(s,r);return n?i.push(n):i.push(...r),i}findMatchingGroup(t,r){var s;for(let i of t.groups)for(let n of r)if(!((s=i.pattern)===null||s===void 0)&&s.test(n))return i.name}addDevice(){return this.addHeader("x-0-device")}addVendor(){return this.addHeader("x-0-vendor")}addIsBot(){return this.addHeader("x-0-device-is-bot")}addBrowser(){return this.addHeader("x-0-browser")}addCookie(t,r){return this.actions.push((s,i)=>{let n=i.headers.cookie||"";Array.isArray(n)&&(n=n.join(";"));let u=Eg.parse(n)[t];r?s.cookies[t]=this.createGroupedValue(r,[u]):s.cookies[t]=u}),this.addValue(`\${req:cookie:${t}}`,r)}addValue(t,r){let s={action:G.CUSTOM_CACHE_KEY_ACTIONS.addValue,value:t};if(r!=null){let i=new zu.default;r(i),s.groups=i.toJSON()}return this.config.push(s),this}getActions(){return this.actions}toJSON(){return this.config}};G.default=Zt});var Qu=f(er=>{"use strict";function Ju(e){for(var t in e)er.hasOwnProperty(t)||(er[t]=e[t])}Object.defineProperty(er,"__esModule",{value:!0});Ju(Xn());Ju(T());var Rg=ye();er.config=Rg.default});var Zu=f(Zn=>{"use strict";Object.defineProperty(Zn,"__esModule",{value:!0});var Xu=Qu();function Cg(e,t={onConflict:"merge"}){return async r=>{let s=e(bg(r.body));if(!Array.isArray(s)){console.warn(`The function provided to deriveSurrogateKeysFromJson should return an array, but returned a value of type "${typeof s}" instead. Surrogate keys will not be set.`);return}let i=new Set(s);if(t.onConflict==="merge"){let n=r.getHeader(Xu.HTTP_HEADERS.x0SurrogateKey);if(n!=null){Array.isArray(n)||(n=[n]);for(let o of n)for(let u of o.split(" "))i.add(u)}}else if(t.onConflict!=="override")throw new Error(`invalid value "${t.onConflict}" for onConflict option in deriveSurrogateKeysFromJson. Use "override" or "merge".`);i.size>0&&r.setHeader(Xu.HTTP_HEADERS.x0SurrogateKey,Array.from(i).join(" "))}}Zn.default=Cg;function bg(e){if(!!e)try{return JSON.parse(typeof e=="string"?e:e.toString("utf8"))}catch{return}}});var ec=f(tr=>{"use strict";var Ag=tr&&tr.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(tr,"__esModule",{value:!0});var wg=Ag(Qn());function Tg(){return new wg.default}tr.default=Tg});var Xn=f(je=>{"use strict";Object.defineProperty(je,"__esModule",{value:!0});var Sg=Wu();je.Router=Sg.default;var xg=Qn();je.CustomCacheKey=xg.default;var Hg=zr();je.ResponseWriter=Hg.default;var Og=Zu();je.deriveSurrogateKeysFromJson=Og.default;var Pg=ec();je.createCustomCacheKey=Pg.default});var qg={};ac(qg,{default:()=>Dg});module.exports=uc(qg);var tc=ti(Xn()),Dg=new tc.Router().fallback(({proxy:e})=>e("origin"));0&&(module.exports={});
/*!
 * Array of passes.
 *
 * A `pass` is just a function that is executed on `req, res, options`
 * so that you can easily add new checks while still keeping the base
 * flexible.
 */
/*!
 * Array of passes.
 *
 * A `pass` is just a function that is executed on `req, socket, options`
 * so that you can easily add new checks while still keeping the base
 * flexible.
 */
/*!
 * Caron dimonio, con occhi di bragia
 * loro accennando, tutte le raccoglie;
 * batte col remo qualunque s’adagia 
 *
 * Charon the demon, with the eyes of glede,
 * Beckoning to them, collects them all together,
 * Beats with his oar whoever lags behind
 *          
 *          Dante - The Divine Comedy (Canto III)
 */
/*!
 * cookie
 * Copyright(c) 2012-2014 Roman Shtylman
 * Copyright(c) 2015 Douglas Christopher Wilson
 * MIT Licensed
 */
//# sourceMappingURL=routes.js.map
